{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"about/","title":"About","text":"<p>Just a regular dude from Norway that recently got into servers. I create how-to's and guides mainly around using Unraid but most of it can be applied to any server running docker ect :)</p> <p>If you have a request or issue you can contact me here:</p> <p>Contact</p>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/","title":"Adding ban/unban notifications from Fail2Ban to Discord!","text":"","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#adding-banunban-notifications-from-fail2ban-to-discord","title":"Adding ban/unban notifications from Fail2Ban to Discord!","text":"<p>Written: 2019-03-05</p> <p>Tags</p> <p> cloudflare </p> <p> discord </p> <p> fail2ban </p> <p> letsencrypt </p> <p>Category</p> <p> backend </p> <p> security </p> <p></p> <p>I thought I would follow up on the Fail2Ban Pushover post with a Fail2Ban Discord post!</p> <p>Docker Mods</p> <p>If you use the linuxserver/letsencrypt container, scroll down to the bottom for a short tutorial on how to use that instead.</p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#creating-the-webhook","title":"Creating the Webhook","text":"<p>In this guide you will be using a Discord webhook to post Fail2Ban notifications to the server of your choice. If you don't have a discord server yet you need to create one. Head over to the <code>Server Settings</code> and select <code>Webhooks</code>. Click on <code>Create Webhook</code> and add the name and channel you want the webhook to post to. At the bottom you will find the webhook url, save that for later.</p> <p></p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#adding-the-discord-action","title":"Adding the Discord action","text":"<p>Head over to your Fail2Ban <code>action.d</code> folder and create a file called <code>discord_notifications.conf</code> and add the following:</p> <pre><code># Author: Gilbn from https://technicalramblings.com\n# Adapted Source: https://gist.github.com/sander1/075736a42db2c66bc6ce0fab159ca683\n# Create the Discord Webhook in: Server settings -&gt; Webhooks -&gt; Create Webhooks\n\n[Definition]\n\n# Notify on Startup\nactionstart = curl -X POST \"&lt;webhook&gt;\" \\\n            -H \"Content-Type: application/json\" \\\n            -d '{\"username\": \"Fail2Ban\", \"content\":\":white_check_mark: The **[&lt;name&gt;]** jail has started\"}'\n\n# Notify on Shutdown\nactionstop = curl -X POST \"&lt;webhook&gt;\" \\\n            -H \"Content-Type: application/json\" \\\n            -d '{\"username\": \"Fail2Ban\", \"content\":\":no_entry: The **[&lt;name&gt;]** jail has been stopped\"}'\n\n#\nactioncheck =\n\n# Notify on Banned \nactionban = curl -X POST \"&lt;webhook&gt;\" \\\n            -H \"Content-Type: application/json\" \\\n            -d '{\"username\":\"Fail2Ban\", \"content\":\":bell: Hey &lt;discord_userid&gt;! **[&lt;name&gt;]** :hammer:**BANNED**:hammer: IP: `&lt;ip&gt;` for &lt;bantime&gt; hours after **&lt;failures&gt;** failure(s). Here is some info about the IP: https://db-ip.com/&lt;ip&gt;\"}' \n            curl -X POST \"&lt;webhook&gt;\" \\\n            -H \"Content-Type: application/json\" \\\n            -d '{\"username\":\"Fail2Ban\", \"content\":\"If you want to unban the IP run: `fail2ban-client unban &lt;ip&gt;`\"}'\n\n# Notify on Unbanned\nactionunban = curl -X POST \"&lt;webhook&gt;\" \\\n            -H \"Content-Type: application/json\" \\\n            -d '{\"username\":\"Fail2Ban\", \"content\":\":bell: **[&lt;name&gt;]** **UNBANNED** IP: [&lt;ip&gt;](https://db-ip.com/&lt;ip&gt;)\"}'\n[Init]\n\n# Name of the jail in your jail.local file. default = [your-jail-name]\nname = default\n\n# Discord Webhook URL\nwebhook = https://discordapp.com/api/webhooks/XXXXXXXXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n</code></pre> <p>Replace the webhook URL with the one from your webhook</p> <p>Warning</p> <p>If you dont want it to notify you on startup/shutdown/unban you can just comment that line with a #.</p> <pre><code>#actionstart = curl -X POST \"&lt;webhook&gt;\" \\\n#            -H \"Content-Type: application/json\" \\\n#            -d '{\"username\": \"Fail2Ban\", \"content\":\":white_check_mark: The **[&lt;name&gt;]** jail has started\"}'\n</code></pre>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#updating-jaillocal","title":"Updating jail.local","text":"<p>Next edit you jail.local file and add the action. You will have to add to all the jails you want notifications on or you can add it below the <code>[DEFAULT]</code> line . Since I use Cloudflare and already have an action in all my jails, I've added it on the line below. If you don't have another action there already you can just add the line <code>action = discord_notifications</code></p> <p>Default action!</p> <p>If you only have the discord action in the jail it will not update the iptables as it replaces the default action. You can add the action **iptables-allports**and it will then run both actions when banning</p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#example","title":"Example","text":"<pre><code>[nginx-http-auth]\n\nenabled  = true\nfilter   = nginx-http-auth\naction   = cloudflare-apiv4\n           discord_notifications[bantime=24, discord_userid=&lt;@!xxxxxxxxxxxxxxxxxxxx&gt;]\niptables-allports\nport     = http,https\nlogpath  = /config/log/nginx/error.log\nignoreip = 192.168.1.0/24\n</code></pre> <p>Note:  The <code>[bantime=24]</code> is just a tag that the action uses. It does not control how long the ban lasts. I default all bans to 24 hours.</p> <p>Note2: The <code>discord_userid=&lt;@!USER-ID-NUMBER&gt;</code> is for mentioning yourself in the server so you can get a ping. To find your user ID-number just type <code>@&lt;username&gt;</code> or <code>@&lt;role&gt;</code>, like so <code>@GilbN#1337</code></p> <p>Don't forget the ! after @ when adding it to the action tag in the jail. The result should look like this:</p> <p></p> <p>If you want to ping a role you need to edit the tag to say <code>&lt;@&amp;ROLE-ID-NUMBER&gt;</code> instead.</p> <p>Note3: The ignore IP is so that fail2ban won't ban your local IP. Check out https://www.aelius.com/njh/subnet_sheet.html if you are wondering what your CIDRnotation is. Most often it will be /24 (netmask 255.255.255.0) To find your netmask run <code>ipconfig /all</code> on windows or <code>ifconfig | grep netmask</code> on linux.</p> <p>After you have added the action to all your jails you need to restart fail2ban. For me that will be to restart the letsencrypt container as I'm using Docker.</p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#discord","title":"Discord","text":"<p>The notifications will look like this: You can change the text by editing the <code>discord_notifications.conf</code> file</p> <p></p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#docker-mods","title":"Docker Mods","text":"<p>If you use the linuxserver/letsencrypt container, Roxedus has made a docker mod that will send pretty embedded notifications to discord on bans!</p> <p>https://github.com/linuxserver/docker-mods/tree/swag-f2bdiscord</p> <p>Simply add these environment variables to the container, and update the jail.local file.</p> <p><code>-e DOCKER_MODS=linuxserver/mods:swag-f2bdiscord</code></p> <p><code>-e DISC_HOOK=40832456738934/7DcEpWr5V24OIEIELjg-KkHky86SrOgTqA</code> This is the last two parts of the webhook url. Scroll up to see how to create a webhook.</p> <p><code>-e DISC_ME=120970603556503552</code> This is the userID that will get mentions on the server. Scroll up for how to find your userid.</p> <p>Add this in your action: <code>discordEmbed[bantime=24]</code>, bantime(hour) is optional, but defaults to 24 when not set. Just reflects in the message, does not change the ban time</p> <p><code>action = cloudflare-apiv4 discordEmbed iptables-allports</code></p>","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here","text":"","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-to-discord/#_1","title":"Adding ban/unban notifications from Fail2Ban to Discord!","text":"","tags":["cloudflare","discord","fail2ban","letsencrypt"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/","title":"Adding ban/unban notifications from Fail2Ban to Pushover!","text":"","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#adding-banunban-notifications-from-fail2ban-to-pushover","title":"Adding ban/unban notifications from Fail2Ban to Pushover!","text":"<p>Written: 2019-03-03</p> <p>Tags</p> <p> cloudflare </p> <p> fail2ban </p> <p> letsencrypt </p> <p> pushover </p> <p> swag </p> <p>Category</p> <p> backend </p> <p> security </p> <p></p> <p>If you're like me and think Fail2Ban is an awesome tool for intrusion protection, getting a notification when someone has been banned is the bee's knees! And using Pushover makes it very simple!</p>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#setting-up-pushover","title":"Setting up Pushover","text":"<p>Head over to https://pushover.net/ and create a user account and add the devices you want to receive notifications. I'm using the iOS app, and that works great for me. The app has a 7 day trail period that lets you try it out without paying for it.</p> <p>On your user page you will see you <code>user key</code>. Save that as we will need that for later. At the bottom you can add your new Fail2Ban application.</p> <p></p> <p>After you've added the new application it will display it's API token. Save that as we will use that for later. You can also test Pushover by sending a notification manually on the user page.</p> <p></p>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#adding-the-pushover-action","title":"Adding the Pushover action","text":"<p>Head over to your Fail2Ban <code>action.d</code> folder and create a file called <code>pushover.local</code> and add the following</p> <pre><code># Fail2Ban Pushover configuration file\n# Adapted Source: https://gist.github.com/sander1/075736a42db2c66bc6ce0fab159ca683\n\n[Definition]\n\n# Notify on Startup\nactionstart = /usr/bin/curl -s -F \"token=&lt;token&gt;\" -F \"user=&lt;user&gt;\" -F \"title=[Fail2Ban] &lt;name&gt;\" -F \"message=Jail &lt;name&gt; has been started successfully.\" https://api.pushover.net/1/messages\n\n# Notify on Shutdown\nactionstop = /usr/bin/curl -s -F \"token=&lt;token&gt;\" -F \"user=&lt;user&gt;\" -F \"title=[Fail2Ban] &lt;name&gt;\" -F \"message=Jail &lt;name&gt; has been stopped.\" https://api.pushover.net/1/messages\n\n#\nactioncheck =\n\n# Notify on Banned\nactionban = /usr/bin/curl -s -F \"token=&lt;token&gt;\" -F \"user=&lt;user&gt;\" -F \"title=[Fail2Ban] &lt;name&gt;\" -F \"message=Banned IP: &lt;ip&gt; Lines containing IP: `grep '&lt;ip&gt;' &lt;logpath&gt;`\" https://api.pushover.net/1/messages\n\n# Notify on Unbanned\nactionunban = /usr/bin/curl -s -F \"token=&lt;token&gt;\" -F \"user=&lt;user&gt;\" -F \"title=[Fail2Ban] &lt;name&gt;\" -F \"message=Unbanned IP: &lt;ip&gt; Lines containing IP: `grep '&lt;ip&gt;' &lt;logpath&gt;`\" https://api.pushover.net/1/messages\n\n[Init]\n\n# Name of the jail in your jail.local file. default = [your-jail-name]\nname = default\n\n# Application token key\ntoken = YOUR-APPLICATION-TOKEN\n# User API key\nuser = YOUR-USER-KEY\n</code></pre> <p>Note</p> <p>If you dont want it to notify you on startup/shutdown/unban you can just comment that line with a #.</p> <pre><code>#actionstart = /usr/bin/curl -s -F \"token=&lt;token&gt;\" -F \"user=&lt;user&gt;\" -F \"title=[Fail2Ban] &lt;name&gt;\" -F \"message=Jail &lt;name&gt; has been started successfully.\" https://api.pushover.net/1/messages\n</code></pre>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#updating-jaillocal","title":"Updating jail.local","text":"<p>Next edit you jail.local file and add the action. You will have to add to all the jails you want notifications on or you can add it below the <code>[DEFAULT]</code> line. Since I use Cloudflare and already have an action in all my jails, I've added it on the line below. If you don't have another action there already you can just add the line <code>action = pushover</code></p> <p>Default action!</p> <p>If you only have the <code>pushover</code> action in the jail it will not update the iptables as it replaces the default action. You can add the action <code>iptables-allports</code> and it will then run both actions when banning</p>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#example","title":"Example","text":"<pre><code>[nginx-http-auth]\n\nenabled  = true\nfilter   = nginx-http-auth\naction   = cloudflare-apiv4\n           pushover\n           iptables-allports\nport     = http,https\nlogpath  = /config/log/nginx/error.log\nignoreip = 192.168.1.0/24\n</code></pre> <p>Note: The ignore IP is so that fail2ban won't ban your local IP. Check out https://www.aelius.com/njh/subnet_sheet.html if you are wondering what your CIDRnotation is. Most often it will be /24 (netmask 255.255.255.0) To find your netmask run <code>ipconfig /all</code> on windows or <code>ifconfig | grep netmask</code> on linux.</p> <p>After you have added the action to all your jails you need to restart fail2ban. For me that will be to restart the swag container as I'm using Docker.</p>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#banning","title":"Banning","text":"<p>A successful ban will look like this:</p> <pre><code>2019-03-03 16:57:09,608 fail2ban.filter         [329]: INFO    [nginx-http-auth-technicalramblings] Found 23.92.127.82 - 2019-03-03 16:57:09\n2019-03-03 16:57:11,612 fail2ban.filter         [329]: INFO    [nginx-http-auth-technicalramblings] Found 23.92.127.82 - 2019-03-03 16:57:11\n2019-03-03 16:57:12,816 fail2ban.filter         [329]: INFO    [nginx-http-auth-technicalramblings] Found 23.92.127.82 - 2019-03-03 16:57:12\n2019-03-03 16:57:12,900 fail2ban.actions        [329]: NOTICE  [nginx-http-auth-technicalramblings] Ban 23.92.127.82\n</code></pre> <p></p> <p></p> <p>Source: https://gist.github.com/sander1/075736a42db2c66bc6ce0fab159ca683</p>","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here","text":"","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/adding-ban-unban-notifications-from-fail2ban-with-pushover/#_1","title":"Adding ban/unban notifications from Fail2Ban to Pushover!","text":"","tags":["cloudflare","fail2ban","letsencrypt","pushover","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/","title":"Blocking countries with GeoLite2 in nginx using the swag/letsencrypt docker container","text":"","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#blocking-countries-with-geolite2-in-nginx-using-the-swagletsencrypt-docker-container","title":"Blocking countries with GeoLite2 in nginx using the swag/letsencrypt docker container","text":"<p>Written: 2019-07-01</p> <p>Tags</p> <p> geoblock </p> <p> geoip </p> <p> geoip2 </p> <p> geolite2 </p> <p> letsencrypt </p> <p> nginx </p> <p> swag </p> <p>Category</p> <p> backend </p> <p> security </p> <p></p> <p>Since the GeoLite legacy database has been discontinued, we now have to use the GeoLite2 database to get new updates to the database. This will be a followup article from the post i made about the legacy database. As the new GeoLite2 database uses a new format (maxminddb) we couldn't just switch to the new database. Nginx also needed to be compiled with the geoip2 modul. And with Aptalca's pull request on the alpine repo added it will just be a matter of a minor update to the <code>nginx.conf</code> file!</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#geolite2-database","title":"GeoLite2 database","text":"<p>Update</p> <p>As of 15.05.20 you can add the variable -e MAXMINDDB_LICENSE_KEY =  to have the container download the database and update it weekly!\"</p> <p>As of 12/30/19 you have to sign up to Maxmind to be able to download the database. https://blog.maxmind.com/2019/12/18/significant-changes-to-accessing-and-using-geolite2-databases/</p> <p>Create an account and go to your account page to download the database.</p> <p></p> <p>Download the database and extract the .mmdb file to the folder of you choice. I'll be using <code>/config/geoip2db/</code> for my setup.</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#nginx","title":"NGINX","text":"<p>In the latest version of nginx.conf there is now a line that says <code>#include /config/nginx/geoip2.conf;</code> Uncomment that line. If you dont have that line, you can just add it.</p> <p>Open the <code>geoip2.conf</code> file and find the line that says <code>map $geoip2_data_country_iso_code $allowed_country {</code> As it says <code>default</code> must be either yes or no. To block everything set it no. Add the country codes you want to allow accessfrom this list. e.g. <code>US yes;</code> This will block all other countries than the one you choose. You can also add more than one country if you want. Like this:</p> <pre><code># GEOIP2 COUNTRY CONFIG\nmap $geoip2_data_country_iso_code $allowed_country {\ndefault no;\nUS yes;\n}\n</code></pre> <p>Now since we have set default to no, you will need to add the local ip ranges that you want to allow access in the <code>$allow_list</code> variable below. Like this:</p> <pre><code># ALLOW LOCAL ACCESS\ngeo $allow_list {\ndefault no;\n192.168.1.0/24 yes;\n}\n</code></pre> <p>Remember to also set default to <code>no</code> in in the <code>$allow_list</code></p> <p>Check out https://www.aelius.com/njh/subnet_sheet.html if you are wondering what your CIDRnotation is. Most often it will be /24 (netmask 255.255.255.0) To find your netmask run <code>ipconfig /all</code> on windows or <code>ifconfig | grep netmask</code> on linux.</p> <p>Note</p> <p>The <code>ALLOW LOCAL ACCESS</code> part is only needed if you set default to no in the <code>map $geoip2_data_country_iso_code</code>config.</p> <p>Setting default to <code>no</code> means that it will block any IP addresses from the database not set to <code>yes</code>, even local ones.</p> <p>For it to actually block you need to add this in your <code>server blocks</code> inside the <code>proxy-confs</code> and <code>site-confs</code> folder:</p> <pre><code>if ($allow_list = yes) {\nset $allowed_country yes;\n}\nif ($allowed_country = no) {\nreturn 444;\n}\n</code></pre> <p>Here is an example using the <code>unifi-controller.subdomain.conf</code> in <code>proxy-confs</code>:</p> <pre><code>server {\nlisten 443 ssl;\nlisten [::]:443 ssl;\n\nserver_name unifi.*;\n\ninclude /config/nginx/ssl.conf;\n\n#COUNTRY GEO BLOCK \nif ($allow_list = yes) { set $allowed_country yes; }    if ($allowed_country = no) {\nreturn 444;\n}\n\nclient_max_body_size 0;\n\n# enable for ldap auth, fill in ldap details in ldap.conf\n#include /config/nginx/ldap.conf;\n\n# enable for Authelia\n#include /config/nginx/authelia-server.conf;\n\nlocation / {\n# enable the next two lines for http auth\n#auth_basic \"Restricted\";\n#auth_basic_user_file /config/nginx/.htpasswd;\n\n# enable the next two lines for ldap auth\n#auth_request /auth;\n#error_page 401 =200 /ldaplogin;\n\n# enable for Authelia\n#include /config/nginx/authelia-location.conf;\n\ninclude /config/nginx/proxy.conf;\nresolver 127.0.0.11 valid=30s;\nset $upstream_app unifi-controller;\nset $upstream_port 8443;\nset $upstream_proto https;\nproxy_pass $upstream_proto://$upstream_app:$upstream_port;\n\nproxy_buffering off;\n}\n}\n</code></pre>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#multiple-geo-blocks","title":"Multiple geo blocks","text":"<p>If you host several websites and want a different country block just add another with a different variable name. e.g. <code>$allowed_country2</code>:</p> <pre><code> # GEO IP BLOCK DOMAIN 2\nmap $geoip2_data_country_iso_code $allowed_country2 {\ndefault yes;\nCN no; #China\nRU no; #Russia\nHK no; #Hong Kong\nIN no; #India\nIR no; #Iran\nVN no; #Vietnam\nTR no; #Turkey\nEG no; #Egypt\nMX no; #Mexico\nJP no; #Japan\nKR no; #South Korea\nKP no; #North Korea :)\nPE no; #Peru\nBR no; #Brazil\nUA no; #Ukraine\nID no; #Indonesia\nTH no; #Thailand\n}\n</code></pre> <p>As <code>default</code> is set to <code>yes</code> it will allow every country except the country codes set to <code>no</code></p> <p>And in the server block add this</p> <pre><code># COUNTRY GEO BLOCK 2\nif ($allowed_country2 = no) {\nreturn 444;\n}\n</code></pre> <p>I made this list based on the Spamhaus statistics and Aakamai's state of the internet report.</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#blocked","title":"Blocked","text":"<p>You can test if it worked with a VPN or do a performance test from a location that is blocked herehttps://www.webpagetest.org/</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#tip-this-database-gets-updated","title":"TIP! This database gets updated","text":"<p>Update</p> <p>As of 15.05.20 you can add the variable -e MAXMINDDB_LICENSE_KEY =  to have the container download the database and update it weekly!\"</p> <p>By setting up a cronjob you can easily automate the update process. I use the Unraid User Scripts plugin and set a cronjob to run every day but the GeoLite2 Country and City databases are updated on the first Tuesday of each month, so choose whatever suits your needs. Click on <code>Add New Script</code> \u2192 Enter the name \u2192 Click on the name of the script and then <code>Edit</code> <code>Script</code></p> <p></p> <p>Warning</p> <p>Since you need to sign up to Maxmind.com to download you need to create a licence key to be able to directly download the database</p> <p>Go to the licence keys page and create a license key. Select <code>no</code> when asked if you want to use the key with geoupdate.</p> <p>Replace XXXXXXXXXX with your license key.</p> <pre><code>#!/usr/bin/env bash\nlicensekey=\"XXXXXXXXXXXXX\"\nwget -O /tmp/GeoLite2-City.tar.gz \"https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-City&amp;license_key=${licensekey}&amp;suffix=tar.gz\"\ntar -xvf /tmp/GeoLite2-City.tar.gz -C /tmp/ --wildcards \"*.mmdb\" --strip 1\nmv /tmp/GeoLite2-City.mmdb /mnt/user/appdata/swag/geolite2/\nchown 911:911 /mnt/user/appdata/letsencrypt/geolite2/GeoLite2-City.mmdb\n</code></pre> <p>Set the schedule to Schedule Daily or whenever you'd like.</p> <p></p> <p>Click <code>Run In Background</code> and then <code>Apply</code></p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#cloudflare","title":"Cloudflare","text":"<p>Update: cloudflare_real-ip - Docker mod for SWAG</p> <p>Check out the docker mod https://github.com/linuxserver/docker-mods/tree/swag-cloudflare-real-ip This mod adds a startup scipt that gets the IP's from Cloudflares edge servers, and formats them in a format Nginx can use with <code>set_real_ip_from</code>.</p> <p>If you use Cloudflare you will need to add the following in nginx so that it won't block the Cloudflare IP but the actual IP of the visitor. If you don't do this you will get false positives.</p> <p>Add the following section to your<code>nginx.conf</code> file found in <code>appdata/swag/nginx/</code></p> <pre><code>set_real_ip_from 103.21.244.0/22;\nset_real_ip_from 103.22.200.0/22;\nset_real_ip_from 103.31.4.0/22;\nset_real_ip_from 104.16.0.0/13;\nset_real_ip_from 104.24.0.0/14;\nset_real_ip_from 108.162.192.0/18;\nset_real_ip_from 131.0.72.0/22;\nset_real_ip_from 141.101.64.0/18;\nset_real_ip_from 162.158.0.0/15;\nset_real_ip_from 172.64.0.0/13;\nset_real_ip_from 173.245.48.0/20;\nset_real_ip_from 188.114.96.0/20;\nset_real_ip_from 190.93.240.0/20;\nset_real_ip_from 197.234.240.0/22;\nset_real_ip_from 198.41.128.0/17;\nset_real_ip_from 2400:cb00::/32;\nset_real_ip_from 2606:4700::/32;\nset_real_ip_from 2803:f800::/32;\nset_real_ip_from 2405:b500::/32;\nset_real_ip_from 2405:8100::/32;\nset_real_ip_from 2c0f:f248::/32;\nset_real_ip_from 2a06:98c0::/29;\n\nreal_ip_header X-Forwarded-For;\n</code></pre> <p>You can set it up as an include like this too:</p> <pre><code>##\n# CF Real IP\n##\ninclude /config/nginx/cf_real-ip.conf;\nreal_ip_header X-Forwarded-For;\n</code></pre> <p>After that you need to restart the swag container for the changes to take effect.</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#automatically-updating-the-cf_real-ipconf","title":"Automatically updating the cf_real-ip.conf","text":"<p>Tronyx over at the discord forums graciously shared his script for updating the Cloudflare ip list. This list is not static and Cloudflare updates it once in a while.</p> <p>The script below will update the list with any changes in the list of IPs from CF</p> <pre><code>#!/usr/bin/env bash\n\ncurl -s 'https://www.cloudflare.com/ips-v4' &gt; /tmp/cf.txt\ncurl -s 'https://www.cloudflare.com/ips-v6' &gt;&gt; /tmp/cf.txt\n\nsed 's/^/set_real_ip_from /' /tmp/cf.txt &gt; /tmp/cf2.txt\n\nsed -e 's/$/;/' /tmp/cf2.txt &gt; /home/swag/config/nginx/cf_real-ip.conf\n</code></pre> <p>I use unraid so I will use the User Scripts plugin to setup a cronjob that will run once a week.</p> <ol> <li>Go to Settings &gt; User Scripts and click <code>Add New Script</code></li> <li>Give it a name and a description if you want</li> <li>Click edit script and add it inside the box.</li> <li>You will need to update the path in the last line to you nginx appdata folder</li> <li>Set the schedule to weekly and click apply and done.</li> </ol> <pre><code>#!/bin/bash\ncurl -s 'https://www.cloudflare.com/ips-v4' &gt; /tmp/cf.txt\ncurl -s 'https://www.cloudflare.com/ips-v6' &gt;&gt; /tmp/cf.txt\n\nsed 's/^/set_real_ip_from /' /tmp/cf.txt &gt; /tmp/cf2.txt\n\nsed -e 's/$/;/' /tmp/cf2.txt &gt; /mnt/user/appdata/swag/nginx/cf_real-ip.conf\n</code></pre>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/#_1","title":"Blocking countries with GeoLite2 in nginx using the swag/letsencrypt docker container","text":"<p>Souce: https://github.com/leev/ngx_http_geoip2_module https://dev.maxmind.com/geoip/legacy/install/country/ http://dev.maxmind.com/geoip/legacy/codes/iso3166/ https://www.howtoforge.com/nginx-how-to-block-visitors-by-country-with-the-geoip-module-debian-ubuntu https://www.spamhaus.org/statistics/botnet-cc/ https://www.akamai.com/us/en/multimedia/documents/state-of-the-internet/q3-2017-state-of-the-internet-security-report.pdf</p>","tags":["geoblock","geoip","geoip2","geolite2","letsencrypt","nginx","swag"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/","title":"Blocking SSH Connections with the GeoLite2 Database","text":"","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/#blocking-ssh-connections-with-the-geolite2-database","title":"Blocking SSH Connections with the GeoLite2 Database","text":"<p>Written by Tronyx 2020-04-28</p> <p>Tags</p> <p> geoblock </p> <p> geolite2 </p> <p> remote </p> <p> security </p> <p> ssh </p> <p>Category</p> <p> security </p> <p></p> <p>This guide will make it possible to block SSH access to your server based on the origin of the IP trying to access it!</p> <p>First and foremost, I need to give credit where it is due. This method is a modified and combined version of these two approaches to achieving this, so most of the credit goes to them:</p> <ul> <li> <p>https://www.claudiokuenzler.com/blog/676/ssh-access-filter-based-on-geoip-database-allow-deny</p> </li> <li> <p>https://www.axllent.org/docs/view/ssh-geoip/</p> </li> </ul>","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/#setting-up-the-maxmind-geolite2-database","title":"Setting up the MaxMind GeoLite2 Database","text":"<p>The first thing we need to do is get yourself a copy of the MaxMind GeoLite2 Database. This will allow the detection of the Country of origin of IP addresses that try to access your Server. You can follow the first bit of instructions from the post \u201cBlocking countries with GeoLite2 in Nginx using the LetsEncrypt Docker container\u201d found here.</p> <p>As the database gets updated regularly, it\u2019s a good idea to automate downloading the database. The above linked post covers that for Unraid, so you can follow those instructions. If you\u2019re not using Unraid, just create the script and create a cronjob manually.</p>","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/#setting-up-geoip-blocking-for-ssh","title":"Setting Up GeoIP Blocking for SSH","text":"<p>Now that the database for the IP lookup is in place, we can move on to configuring the use of the lookup to deny SSH access to the Server based on the Country the IP is associated with.</p> <p>We will need to install two packages to get this all working. The first one is the command-line tool for performing the IP lookups, <code>mmdb-bin</code>. The second one is a modified grep utility, called <code>grepcidr</code>, for CIDR notated IP addresses, IE: <code>192.168.1.0/24</code>. On Ubuntu 18.04, you can do this with the following command:</p> <p><code>apt install mmdb-bin grepcidr</code></p> <p>Next, we will setup the script that performs the lookup of the IP address that is attempting to access your Server to determine the Country that it\u2019s coming from. Create the script wherever you would like, but make sure it\u2019s easy to remember as we will need it for another step, IE: <code>/home/tronyx/scripts/ssh_filter.sh</code>. Paste in the following code to create the script:</p> <pre><code>#!/usr/bin/env bash\n\n# UPPERCASE space-separated country codes to ACCEPT\nALLOW_COUNTRIES=\"US\" # Make sure you add your Country code here\n# Space-separated list of IPs to whitelist\n# You can use CIDR notation as well, IE: 192.168.1.0/24\nALLOW_IPS=\"\" # You can add your public IP address here\n\nif [[ $# -ne 1 ]]; then\necho \"Usage:  `basename $0` &lt;ip&gt;\" 1&gt;&amp;2\nexit 0 # return true in case of config issue\nfi\n\n# Fixed static IP\necho $1 | /usr/bin/grepcidr \"$ALLOW_IPS\" &amp;&gt; /dev/null\n\nif [ ${PIPESTATUS[1]} -eq 0 ]; then\nRESPONSE=\"ALLOW\"\nlogger \"$RESPONSE sshd connection from $1 (Whitelisted)\"\nexit 0\nfi\n\nCOUNTRY=\"$(/usr/bin/mmdblookup -f /home/letsencrypt-vps/config/geolite2/GeoLite2-City.mmdb -i \"$1\" country iso_code 2&gt;&amp;1| awk -F '\"' '{ print $2 }'|head -n 2|tail -n 1)\"\n\n[[ $COUNTRY = \"IP Address not found\" || $ALLOW_COUNTRIES =~ $COUNTRY ]] &amp;&amp; RESPONSE=\"ALLOW\" || RESPONSE=\"DENY\"\n\nif [ $RESPONSE = \"ALLOW\" ]\nthen\nexit 0\nelse\nlogger \"$RESPONSE sshd connection from $1 ($COUNTRY)\"\nexit 1\nfi\n</code></pre> <p>Make sure to put the country codes into the allow for any Country that you want to allow access from, especially the Country that you live in, so that you do not lose access to your Server. You can find a list of all of the country codes HERE. If you would like, you can add your public IP address to the whitelist, if your server is remote, to ensure you never get blocked, but you shouldn\u2019t be blocking the Country where you live anyway. Make the script executable with the following command:</p> <p><code>chmod a+x /home/tronyx/scripts/ssh_filter.sh</code></p>","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/#locking-down-ssh","title":"Locking Down SSH","text":"<p>The final thing that we need to do is lock SSH down by telling it what IP addresses to deny and which ones to allow, determined by the script that we just created. Add the following to the <code>/etc/hosts.deny</code> file: <code>sshd: ALL</code> This will initially block all connections to the Server via SSH. Then, add the following to the <code>/etc/hosts.allow</code> file:</p> <p><code>sshd: ALL: aclexec /home/tronyx/scripts/ssh_filter.sh %a</code></p> <p>This part tells it to execute the <code>ssh_filter.sh</code> script against the IP address that is attempting to connect to the Server via SSH to determine whether or not the IP address is allowed to connect. If the lookup of the IP address fails to determine the Country it\u2019s from, like a private IP address for example, it will allow the connection.</p>","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/blocking-ssh-connections-with-the-geolite2-database/#time-to-test","title":"Time to Test","text":"<p>Now that we\u2019ve got all of the requirements in place, we can test the script to make sure that it\u2019s doing what it\u2019s supposed to. We can do this by running the script against some IP addresses from Countries that we\u2019ve configured the script to block and allow. I am located in the US, so I\u2019m going to first test the IP of one of Google\u2019s DNS Servers:</p> <p><code>/home/tronyx/scripts/ssh_filter.sh 8.8.8.8</code></p> <p>The script will not output anything, and it\u2019s only configured to log deny and whitelist messages to the <code>/var/log/syslog</code> file, so you want to make sure that you do not see a deny message for the IP address you are testing. Next, as I\u2019m only allowing IP addresses from the US, I\u2019m going to test an IP address from China and one from Germany to make sure I see a deny message in the syslog for both of them:</p> <p><code>/home/tronyx/scripts/ssh_filter.sh 222.186.180.130 /home/tronyx/scripts/ssh_filter.sh 95.217.185.78</code></p> <p>Looking at the at the <code>/var/log/syslog</code> file, I see that both IP addresses were denied:</p> <pre><code>Apr 26 12:05:04 1and1-vps root: DENY sshd connection from 222.186.180.130 (CN)\nApr 26 12:07:11 1and1-vps tronyx: DENY sshd connection from 95.217.185.78 (DE)\n</code></pre> <p>A user that was trying to connect to your Server via SSH from a Country that you\u2019re blocking would simply see that the connection was closed or that it was unable to be established, like this:</p> <p><code>ssh_exchange_identification: Connection closed by remote host</code></p> <p>When accessing SSH from an IP address that you\u2019ve added to the whitelist, the entry in the <code>/var/log/syslog</code> will look like this:</p> <pre><code>Apr 26 12:07:30 1and1-vps tronyx: ALLOW sshd connection from 192.168.1.2 (Whitelisted)\n</code></pre> <p>Congratulations, your Server is now denying SSH connections based on the Country in which the IP address is associated!</p>","tags":["geoblock","geolite2","remote","security","ssh"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/","title":"How to setup Cloudflare and fail2ban with automated \"set_real_ip_from\" in nginx","text":"","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#how-to-setup-cloudflare-and-fail2ban-with-automated-set_real_ip_from-in-nginx","title":"How to setup Cloudflare and fail2ban with automated \"set_real_ip_from\" in nginx","text":"<p>Written: 2018-10-01</p> <p>Tags</p> <p> access </p> <p> ban </p> <p> cloudflare </p> <p> fail2ban </p> <p> letsencrypt </p> <p> nginx </p> <p> security </p> <p> swag </p> <p> unraid </p> <p>Category</p> <p> backend </p> <p> security </p> <p></p> <p>If you've decided to use cloudflare as a CDN you've might have noticed that fail2ban isn't working as expected. The fail2ban.log file will say that it has banned an IP, but since the connection is going through Cloudflare it will still let the banned IP browse your website. But luckily Cloudflare has an API we can use to update the Cloudflare firewall on the fly.</p>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#adding-the-action","title":"Adding the action","text":"<p>If you've read my other fail2ban guides you already know I'm using linuxservers swag container. So there won't be any walkthrough of installing fail2ban. I will only go through the cloudflare configuration.</p> <p>Go to your appdata location and find the <code>action.d</code> folder <code>appdata/swag/fail2ban/action.d</code></p> <p>In that folder there already is an action for cloudflare (cloudflare.conf) but that is using the deprecated API. Create a new file called <code>cloudflare-apiv4.conf</code> and add the following:</p> <pre><code>#\n# Author: Gilbn from https://technicalramblings.com\n# Adapted Source: https://github.com/fail2ban/fail2ban/blob/master/config/action.d/cloudflare.conf and https://guides.wp-bullet.com/integrate-fail2ban-cloudflare-api-v4-guide/\n#\n# To get your Cloudflare API key: https://dash.cloudflare.com/profile use the Global API Key\n#\n\n[Definition]\n\n# Option:  actionstart\n# Notes.:  command executed once at the start of Fail2Ban.\n# Values:  CMD\n#\nactionstart =\n\n# Option:  actionstop\n# Notes.:  command executed once at the end of Fail2Ban\n# Values:  CMD\n#\nactionstop =\n\n# Option:  actioncheck\n# Notes.:  command executed once before each actionban command\n# Values:  CMD\n#\nactioncheck =\n\n# Option:  actionban\n# Notes.:  command executed when banning an IP. Take care that the\n#          command is executed with Fail2Ban user rights.\n# Tags:      IP address\n#            number of failures\n#            unix timestamp of the ban time\n# Values:  CMD\n\nactionban = curl -s -X POST \"https://api.cloudflare.com/client/v4/user/firewall/access_rules/rules\" \\\n-H \"X-Auth-Email: &lt;cfuser&gt;\" \\\n-H \"X-Auth-Key: &lt;cftoken&gt;\" \\\n-H \"Content-Type: application/json\" \\\n--data '{\"mode\":\"block\",\"configuration\":{\"target\":\"ip\",\"value\":\"&lt;ip&gt;\"},\"notes\":\"Fail2ban &lt;name&gt;\"}'\n\n# Option:  actionunban\n# Notes.:  command executed when unbanning an IP. Take care that the\n#          command is executed with Fail2Ban user rights.\n# Tags:      IP address\n#            number of failures\n#            unix timestamp of the ban time\n# Values:  CMD\n#\n\nactionunban = curl -s -X DELETE \"https://api.cloudflare.com/client/v4/user/firewall/access_rules/rules/$( \\\ncurl -s -X GET \"https://api.cloudflare.com/client/v4/user/firewall/access_rules/rules?mode=block&amp;configuration_target=ip&amp;configuration_value=&lt;ip&gt;&amp;page=1&amp;per_page=1&amp;match=all\" \\\n-H \"X-Auth-Email: &lt;cfuser&gt;\" \\\n-H \"X-Auth-Key: &lt;cftoken&gt;\" \\\n-H \"Content-Type: application/json\" | awk -F\"[,:}]\" '{for(i=1;i&lt;=NF;i++){if($i~/'id'\\042/){print $(i+1);}}}' | tr -d '\"' | sed -e 's/^[ \\t]*//' | head -n 1)\" \\\n-H \"X-Auth-Email: &lt;cfuser&gt;\" \\\n-H \"X-Auth-Key: &lt;cftoken&gt;\" \\\n-H \"Content-Type: application/json\"\n\n[Init]\n\n# Name of the jail in your jail.local file. default = [jail name]\nname = default\n\n# Option: cfuser\n# Notes.: Replaces &lt;cfuser&gt; in actionban and actionunban with cfuser value below\n# Values: Your CloudFlare user account\n\ncfuser = user@mail.com\n\n# Option: cftoken (Global API Key)\n# Notes.: Replaces &lt;cftoken&gt; in actionban and actionunban with cftoken value below\n# Values: Your CloudFlare API key \ncftoken = YOUR-API-KEY\n</code></pre> <p>The unban curl command from https://guides.wp-bullet.com/integrate-fail2ban-cloudflare-api-v4-guide/ did not work for me but changing it to what this user on serverfault shared didhttps://serverfault.com/a/912547</p> <p>At the end of the config file add your cloudflare email on the \"cfuser\" line and add your Cloudflare token on the \"cftoken\" line.</p> <p>Your Cloudflare token can be found on your profile page. Use the \"Global API Key\"</p> <p></p>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#updating-jaillocal","title":"Updating jail.local","text":"<p>Next is updating or adding your jails in the jail.local file. Go to your appdata location **<code>appdata/swag/fail2ban/</code>**and edit the file called jail.local. The only thing you really need to add is the action fail2ban will run after it has banned an IP.</p> <p>Add <code>action = cloudflare-apiv4</code> in the jails you want to use it on. For me that would be all the jails.</p> <p>Default action!</p> <p>If you only have the <code>cloudflare</code> action in the jail it will not update the iptables as it replaces the default action. You can add the action <code>iptables-allports</code> and it will then run both actions when banning</p> <pre><code>[nginx-http-auth]\n\nenabled  = true\nfilter   = nginx-http-auth\naction   = cloudflare-apiv4\n           iptables-allports\nport     = http,https\nlogpath  = /config/log/nginx/error.log\nignoreip = 192.168.1.0/24\n</code></pre> <pre><code>[organizrv2-auth]\n\nenabled  = true\nfilter   = organizrv2-auth\naction   = cloudflare-apiv4\n           iptables-allports\nport     = http,https\nlogpath  = /fail2ban/organizrLoginLog.json\nignoreip = 192.168.1.0/24\n</code></pre>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#optional-specifying-which-site-the-ban-works-on","title":"Optional: Specifying which site the ban works on","text":"<p>If you have several sites on your Cloudflare account and you want to specify which one the action should work on, you need to change the URL on the actionban line. Instead of user it needs to say zones and then your zone ID.</p> <pre><code>actionban = curl -s -X POST \"https://api.cloudflare.com/client/v4/zones/YOUR-CLOUDFLARE-ZONE-ID/firewall/access_rules/rules\" \\\n</code></pre> <p>And the same on the actionunban line:</p> <pre><code>actionunban = curl -s -X DELETE \"https://api.cloudflare.com/client/v4/zones/YOUR-CLOUDFLARE-ZONE-ID/firewall/access_rules/rules/$( \\ curl -s -X GET \"https://api.cloudflare.com/client/v4/zones/YOUR-CLOUDFLARE-ZONE-ID/firewall/access_rules/rules?mode=block&amp;configuration_target=ip&amp;configuration_value=1.2.3.4&amp;page=1&amp;per_page=1&amp;match=all\" \\\n</code></pre> <p>Your zone ID can be found on the overview page on Cloudflare.</p> <p></p> <p>Whitelist</p> <p>I recommend adding a whitelist on your WAN IP so you don't accidently ban yourself!</p> <p>You can add the whitelist on Cloudflare by going to Firewall and then Tools. There you can add the access rule.</p> <p></p>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#nginx","title":"Nginx","text":"<p>Next up is configuring nginx so that it won't just ban the Cloudflare CDN IP but the actual IP of the visitor.</p> <p>Add the following section to your http block in the <code>nginx.conf</code> file found in <code>appdata/swag/nginx/</code></p> <pre><code>set_real_ip_from 103.21.244.0/22;\nset_real_ip_from 103.22.200.0/22;\nset_real_ip_from 103.31.4.0/22;\nset_real_ip_from 104.16.0.0/12;\nset_real_ip_from 108.162.192.0/18;\nset_real_ip_from 131.0.72.0/22;\nset_real_ip_from 141.101.64.0/18;\nset_real_ip_from 162.158.0.0/15;\nset_real_ip_from 172.64.0.0/13;\nset_real_ip_from 173.245.48.0/20;\nset_real_ip_from 188.114.96.0/20;\nset_real_ip_from 190.93.240.0/20;\nset_real_ip_from 197.234.240.0/22;\nset_real_ip_from 198.41.128.0/17;\nset_real_ip_from 2400:cb00::/32;\nset_real_ip_from 2606:4700::/32;\nset_real_ip_from 2803:f800::/32;\nset_real_ip_from 2405:b500::/32;\nset_real_ip_from 2405:8100::/32;\nset_real_ip_from 2c0f:f248::/32;\nset_real_ip_from 2a06:98c0::/29;\n\nreal_ip_header X-Forwarded-For;\n</code></pre> <p>The IP's are from these URLS: https://www.cloudflare.com/ips-v4</p> <p>https://www.cloudflare.com/ips-v6</p> <p>You can set it up as an include like this too:</p> <pre><code>##\n# CF Real IP\n##\ninclude /config/nginx/cf_real-ip.conf;\nreal_ip_header X-Forwarded-For;\n</code></pre> <p>After that you need to restart the swag container for the changes to take effect.</p> <p>Next you can test that it actually works by using a vpn ect and ban yourself. Set bantime to 60 for it to only ban the IP for 1 minute. After the IP is banned you can see the new firewall rule on cloudflare dashboard.</p> <p></p> <p>I've noticed that with the new API it is much faster in banning and unbanning IP's! When using the old API it could sometimes take up to 2 minutes for the rule to show in Cloudflare. Now it's there in a matter of seconds.</p>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#automatically-updating-the-cf_real-ipconf","title":"Automatically updating the cf_real-ip.conf","text":"<p>Tronyx over at the discord forums graciously shared his script for updating the Cloudflare ip list. This list is not static and Cloudflare updates it once in a while.</p> <p>The script below will update the list with any changes in the list of IPs from CF</p> <pre><code>#!/bin/bash\nprintf \"set_real_ip_from %b;\\n\" $({\ncurl -s -w '\\n' \"https://www.cloudflare.com/ips-v4\" &amp;\ncurl -s -w '\\n' \"https://www.cloudflare.com/ips-v6\" &amp;\nip route | grep -v default | awk '{print $1}'\n}) &gt; /mnt/nvme/docker/swag/nginx/cf_real-ip.conf\n</code></pre> <p>I use unraid so I will use the User Scripts plugin to setup a cronjob that will run once a week.</p> <ol> <li>Go to Settings &gt; User Scripts and click <code>Add New Script</code></li> <li>Give it a name and a description if you want</li> <li>Click edit script and add it inside the box.</li> <li>You will need to update the path in the last line to you nginx appdata folder</li> <li>Set the schedule to weekly and click apply and done.</li> </ol> <pre><code>#!/bin/bash\nprintf \"set_real_ip_from %b;\\n\" $({\ncurl -s -w '\\n' \"https://www.cloudflare.com/ips-v4\" &amp;\ncurl -s -w '\\n' \"https://www.cloudflare.com/ips-v6\" &amp;\nip route | grep -v default | awk '{print $1}'\n}) &gt; /mnt/user/docker/swag/nginx/cf_real-ip.conf\n</code></pre>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here","text":"","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/cloudflare-fail2ban-integration-with-automated-set_real_ip_from-in-nginx/#_1","title":"How to setup Cloudflare and fail2ban with automated \"set_real_ip_from\" in nginx","text":"<p>Sources:</p> <p>Tronyx \ud83d\ude18 Thank you Tronyx for creating the first draft of the guide.</p> <p>https://guides.wp-bullet.com/integrate-fail2ban-cloudflare-api-v4-guide</p> <p>https://serverfault.com/a/912547</p>","tags":["access","ban","cloudflare","fail2ban","letsencrypt","nginx","security","swag","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/","title":"How to add a custom login page for Unraid!","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#how-to-add-a-custom-login-page-for-unraid","title":"How to add a custom login page for Unraid!","text":"<p>Written: 2021-03-15</p> <p>Tags</p> <p> animated </p> <p> css </p> <p> customization </p> <p> javascript </p> <p> server </p> <p> unraid </p> <p>Category</p> <p> frontend </p> <p></p> <p>As I said in my previous post, I have for some time now been creating css themes/skins for different applications that reside in the \u201cmedia server/selfhosting\u201d category. That also included the Unraid webUI, but up until recently only the login page. Last week I added the rest of the WebUI to the theme suite.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#custom-login-page","title":"Custom login page","text":"<p>The custom login page have 3 types with different sub themes. Retro Terminal, Alien and Fallout</p> <pre><code>   \u251c\u2500\u2500 Retro Terminal\n   \u2502   \u251c\u2500\u2500 amber.css\n   \u2502   \u251c\u2500\u2500 red.css\n   \u2502   \u251c\u2500\u2500 green.css\n   \u2502   \u251c\u2500\u2500 blue.css\n   \u2502   \u251c\u2500\u2500 white.css\n   \u2502   \u2514\u2500\u2500 custom.css /* Make it your own */\n   \u251c\u2500\u2500 Alien\n   \u2502   \u251c\u2500\u2500 hallway.css\n   \u2502   \u251c\u2500\u2500 hallway2.css\n   \u2502   \u251c\u2500\u2500 hallway3.css\n   \u2502   \u251c\u2500\u2500 hallway4.css\n   \u2502   \u251c\u2500\u2500 isolation.css\n   \u2502   \u251c\u2500\u2500 isolation_video.css\n   \u2502   \u251c\u2500\u2500 scanner.css\n   \u2502   \u251c\u2500\u2500 nightmare.css\n   \u2502   \u2514\u2500\u2500 custom.css /* Make it your own */\n   \u2514\u2500\u2500 Fallout\n       \u251c\u2500\u2500 terminal.css\n       \u251c\u2500\u2500 terminal2.css\n       \u251c\u2500\u2500 dirty_terminal.css\n       \u251c\u2500\u2500 dirty_terminal2.css\n       \u251c\u2500\u2500 fallout_video.css\n       \u2514\u2500\u2500 custom.css /* Make it your own */\n</code></pre>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#retro-terminal","title":"Retro Terminal","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#alien","title":"Alien","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#fallout","title":"Fallout","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#installation","title":"Installation","text":"<p>To install the custom css and javascript(optional) we must edit the html in the <code>login.php</code> file located at <code>/usr/local/emhttp/login.php</code> To do that , I've created a bash script that uses sed to inject an html link tag for our custom css stylesheet.  </p> <p>If you're unfamiliar with running scripts, the easiest way to run would be to use the plugin**CA User Scripts.** Install the plugin and add a new user script by clicking <code>Add new script</code> Give it a name and click OK</p> <p></p> <p>Click or hover over the gear icon and click <code>Edit Script</code></p> <p></p> <p>Paste the contents of the bash script:custom_login.sh </p> <p>Below the shebang(<code>#!/bin/bash</code>) are the variables you need to change for the different themes.</p> <p></p> <p>The default values are the ones below</p> <pre><code>TYPE=\"retro-terminal\"\nTHEME=\"green.css\"\nDOMAIN=\"theme-park.dev\"\nADD_JS=\"true\"\nJS=\"custom_text_header.js\"\nDISABLE_THEME=\"false\"\n</code></pre> <p>Set the values to what you like, and click <code>Save Changes</code> To have the script applied at every boot, set the schedule to <code>At Startup of Array</code> Now just click <code>Run Script</code>and it will print some text in the window.</p> <p>Thats it.. logout and have a look at your new theme :)</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#javascript","title":"Javascript","text":"<p>The javascript variable will add some custom html tags into the login page. The Retro Terminal javascript adds an animated <code>&lt;pre&gt;</code> tag that says nostromolink. It's inspired by a blog post by Stephen Brennan. If you want something else, there are a ton of ACSII generators out there.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#retro-terminal-javascript","title":"Retro Terminal Javascript","text":"<ol> <li>Set<code>ADD_JS</code>to<code>\"true\"</code> to enable.</li> <li>Set <code>JS</code> to <code>custom_text_header.js</code></li> </ol> <p>custom_text_header.js </p> <p></p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#alien-theme-javascript","title":"Alien Theme Javascript","text":"<p>isolation.js Injects an animated video wallpaper from the Alien: Isolation game.</p> <ol> <li>Set<code>THEME</code>to<code>isolation_video.css</code></li> <li>Set<code>ADD_JS</code>to<code>\"true\"</code></li> <li>Set <code>JS</code> to <code>isolation.js</code></li> </ol> <p></p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#fallout-theme-javascript","title":"Fallout Theme Javascript","text":"<p>please_stand_by.js vault-tec-crt.js vault-tec-crt_no-scanline.js</p> <ol> <li>Set<code>THEME</code>to<code>fallout_video.css</code></li> <li>Set<code>ADD_JS</code>to<code>\"true\"</code>to enable.</li> <li>Choose the video you want. See:videos<ul> <li>Available js:<code>please_stand_by.js</code>,<code>vault-tec-crt.js</code>,<code>vault-tec-crt_no-scanline.js</code></li> </ul> </li> <li>Set<code>JS</code>to the one you want.</li> </ol> <p>vault-tec-crt.js</p> <p></p> <p>vault-tec-crt_no-scanline.js</p> <p></p> <p>please_stand_by.js </p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#faq","title":"FAQ","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#backups","title":"Backups","text":"<p>The script will create a backup of the login.php file if one does not exist.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#uninstallrestore-the-original","title":"Uninstall/Restore the original","text":"<p>To uninstall the theme set the variable <code>DISABLE_THEME</code> to <code>\"true\"</code></p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#can-i-selfhost-this","title":"Can I selfhost this?","text":"<p>Of course! Just clone the repo into your webserver. Remember to change the <code>DOMAIN</code> variable in the bash script.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#my-server-is-not-connected-to-the-internet-how-can-i-add-this","title":"My server is not connected to the internet! How can I add this?","text":"<p>With the current version of the bash script, that is not possible as it injects the stylesheet using the a URL and not a file path. However, nothing is stopping you from just doing some small changes to the script and replace the <code>href</code> urls to the path you stored the files. I will try and create a version of the script that is made for local hosting in the future.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#i-hate-the-flickering","title":"I hate the flickering","text":"<p>To remove the background flickering you need to edit the css file. Now since you don't have any control over those files, you'll need to fork it and setup Github pages or selfhost them. You can't use the raw link from Github, as they don't pass the mime types.</p> <p>The background flickering can be disabled by setting the<code>--body-animation</code> root variable to <code>none</code></p> <p>The <code>&lt;pre&gt;</code> tag flicker can be disabled by setting <code>--custom-text-header-animation</code> to <code>none</code>.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#i-hate-the-crt-lines","title":"I hate the CRT lines","text":"<p>Set the <code>--body-before</code> and <code>--body-after</code> root variables to <code>none</code></p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#i-want-my-own-logo","title":"I want my own logo","text":"<p>Fork it and change the <code>--logo</code> variable or if you're using stylus ect, just add a new <code>--logo</code> root variable below the import line.</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#i-dont-like-xyz","title":"I don't like XYZ","text":"<p>To change the colors,background, logo ect you need to edit the css file. Now since you don't have any control over those files, you'll need to fork it and setup Github pages or selfhost the files. You can't use the raw link from Github, as they don't pass the mime types. Each css file have a bunch of variables you can change to your linking. All CSS and javascript files can be found here: https://github.com/gilbN/theme.park/tree/master/css/addons/unraid/login-page</p> <p>Example:</p> <pre><code>:root {\n--main-bg-color:black;\n--body-before:#00ff771a;\n--body-after: #00ff7733;\n--body-animation: flicker;\n--logo: url(https://theme-park.dev/css/addons/unraid/login-page/alien/logo/wings_green.png) center no-repeat;\n--text-color: #37f592;\n--input-color: #37f592;\n--link-color: #37f592;\n--link-color-hover: #68ffff;\n--case-color: #37f592;\n--button-text-color: #37f592;\n--button-text-color-hover: #000;\n--button-color: #37f592;\n--button-color-hover: #68ffff;\n--selection-color: #68ffff;\n--custom-text-header:#37f592;\n--custom-text-header-shadow:#37f592;\n--custom-text-header-animation: textflicker;\n--input-font: 'Share Tech Mono', monospace;\n--text-font: 'Share Tech Mono', monospace;\n--loginbox-background-color: transparent;\n--text-shadow: 0 0 8px;\n--text-shadow-color: #37f592;\n--box-shadow: 0 0 15px;\n}\n</code></pre>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#custom-unraid-themes","title":"Custom Unraid Themes","text":"","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-a-custom-login-page-for-unraid/#installation_1","title":"Installation","text":"<p>The custom themes for the Unraid WebUI are the same as the ones in my theme.park repository.</p> <p>Aquamarine, Hotline, Plex, Space-gray, Dark, and Organizr-dark.</p> <p>The easiest way to add them is to use the Theme Engine plugin.</p> <ol> <li>Install theTheme Engineplugin from the CA appstore and open it.</li> <li>Set <code>Base Theme</code> to black</li> <li>Enable<code>Advanced View</code></li> <li>Scroll down and set <code>Enable custom styling (below):</code> to <code>Yes</code></li> <li>Add the HTML below in the <code>Custom styling (advanced):</code> textarea. Remember to change<code>&lt;THEME&gt;</code> to the theme you want.</li> </ol> <pre><code>&lt;/style&gt;&lt;link type=\"text/css\" rel=\"Stylesheet\" href=\"https://theme-park.dev/css/themes/unraid/&lt;THEME&gt;.css\" /&gt;\n</code></pre> <p>Example:</p> <pre><code>&lt;/style&gt;&lt;link type=\"text/css\" rel=\"Stylesheet\" href=\"https://theme-park.dev/css/themes/unraid/plex.css\" /&gt;\n</code></pre> <p></p> <p>Installation</p>","tags":["animated","css","customization","javascript","server","unraid"]},{"location":"blog/how-to-add-dark-mode-to-any-app-with-this-one-simple-trick/","title":"How to add dark mode to any app with this one simple trick!","text":"","tags":["containers","dark-theme","docker","docker_mods","letsencrypt","linuxserver","nginx","proxy","reverse","skins","swag","theme-park","themes","unraid"]},{"location":"blog/how-to-add-dark-mode-to-any-app-with-this-one-simple-trick/#how-to-add-dark-mode-to-any-app-with-this-one-simple-trick","title":"How to add dark mode to any app with this one simple trick!","text":"<p>Written: 2021-01-03</p> <p>Tags</p> <p> containers </p> <p> dark-theme </p> <p> docker </p> <p> docker_mods </p> <p> letsencrypt </p> <p> linuxserver </p> <p> nginx </p> <p> proxy </p> <p> reverse </p> <p> skins </p> <p> swag </p> <p> theme-park </p> <p> themes </p> <p> unraid </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p></p> <p>Developers hate me for sharing this one weird trick!</p> <p>Yes..the title is clickbait, and no this does not work on any app/container ;)</p> <p>I have for some time now been creating css themes/skins for different applications that reside in the \"media server/selfhosting\" category. Normally you would add the themes using a \"subfilter\" module like http://nginx.org/en/docs/http/ngx_http_sub_module.html or https://httpd.apache.org/docs/2.4/mod/mod_filter.html. This means that you would have to reverse proxy the application to be able to add the theme. Doing that would only apply the theme when accessing the application though the proxy and not locally.</p> <p>So, to fix that I've created a bunch of docker mods for all the applications that have a linuxserver container. The docker mod, will run a script at startup to inject the stylesheet into the html file using sed. The script does the exact same thing as the subfiltering module except it does it on the backend instead of on the proxy side. You can find all the mods here: https://github.com/GilbN/theme.park/tree/master/docker-mods</p> <p>The scripts are quite simple and only has a couple of variables. <code>TP_DOMAIN</code> and <code>TP_THEME</code> Both these variable have a default value if not set. <code>TP_DOMAIN</code> is set to <code>theme-park.dev</code> and <code>TP_THEME</code> is set to <code>organizr</code></p> <p>Example:</p> <pre><code>#!/usr/bin/with-contenv bash\n\necho '---------------------------'\necho '|  Sonarr theme.park Mod  |'\necho '---------------------------'\n\n# Display variables for troubleshooting \necho -e \"Variables set:\\\\n\\\n'TP_DOMAIN'=${TP_DOMAIN}\\\\n\\\n'TP_COMMUNITY_THEME'=${TP_COMMUNITY_THEME}\\\\n\\\n'TP_ADDON'=${TP_ADDON}\\\\n\\\n'TP_THEME'=${TP_THEME}\\\\n\"\n\nAPP_FILEPATH='/app/sonarr/bin/UI/index.html'\nLOGIN_FILEPATH='/app/sonarr/bin/UI/login.html'\nif [ \"${TP_HOTIO}\" = true ]; then\necho 'Changing to Hotio file path!'\nAPP_FILEPATH='/app/bin/UI/index.html'\nLOGIN_FILEPATH='/app/bin/UI/login.html'\nfi\n\n# Set default\nif [[ -z ${TP_DOMAIN} ]]; then\necho 'No domain set, defaulting to theme-park.dev'\nTP_DOMAIN='theme-park.dev'\nfi\n\nTHEME_TYPE='theme-options'\nif [ \"${TP_COMMUNITY_THEME}\" = true ]; then\nTHEME_TYPE='community-theme-options'\nfi\n\ncase ${TP_DOMAIN} in\n*\"github.io\"*)\necho \"Switching to github.io URL style\"\nTP_DOMAIN=\"${TP_DOMAIN}\\/theme.park\"\n;;\nesac\n\nif [[ -z ${TP_THEME} ]]; then\necho 'No theme set, defaulting to organizr'\nTP_THEME='organizr'\nfi\n\n# Adding stylesheets\nif ! grep -q \"${TP_DOMAIN}/css/base\" \"${APP_FILEPATH}\"; then\necho '---------------------------'\necho '|  Adding the stylesheet  |'\necho '---------------------------'\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/base\\/sonarr\\/sonarr-base.css'&gt;&lt;\\/head&gt; /g\" \"${APP_FILEPATH}\"\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/${THEME_TYPE}\\/${TP_THEME}.css'&gt;&lt;\\/head&gt; /g\" \"${APP_FILEPATH}\"\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/base\\/sonarr\\/sonarr-base.css'&gt;&lt;\\/head&gt; /g\" \"${LOGIN_FILEPATH}\"\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/${THEME_TYPE}\\/${TP_THEME}.css'&gt;&lt;\\/head&gt; /g\" \"${LOGIN_FILEPATH}\"\nprintf 'Stylesheet set to %s\\n' \"${TP_THEME}\"\nif [[ -n ${TP_ADDON} ]]; then\nfor addon in $(echo \"$TP_ADDON\" | tr \"|\" \" \"); do\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/addons\\/sonarr\\/${addon}\\/${addon}.css'&gt;&lt;\\/head&gt; /g\" \"${APP_FILEPATH}\"\nsed -i \"s/&lt;\\/head&gt;/&lt;link rel='stylesheet' href='https:\\/\\/${TP_DOMAIN}\\/css\\/addons\\/sonarr\\/${addon}\\/${addon}.css'&gt;&lt;\\/head&gt; /g\" \"${LOGIN_FILEPATH}\"\nprintf 'Added custom addon: %s\\n\\n' \"${addon}\"\ndone\nfi\nfi\n</code></pre>","tags":["containers","dark-theme","docker","docker_mods","letsencrypt","linuxserver","nginx","proxy","reverse","skins","swag","theme-park","themes","unraid"]},{"location":"blog/how-to-add-dark-mode-to-any-app-with-this-one-simple-trick/#adding-the-theme","title":"Adding the theme","text":"<p>Adding the mod, is quite simple. Add the variable <code>DOCKER_MODS=ghcr.io/gilbn/theme.park:&lt;app&gt;</code> e.g. <code>ghcr.io/gilbn/theme.park:sonarr</code> to your docker run command or compose file.</p> <p>On Unraid simply click on <code>+ Add another Path, Port, Variable, label or Device</code></p> <p></p> <p>And fill out the fields.</p> <p></p> <p>As noted earlier it will default to the organizr theme and the <code>theme-park.dev</code> domain. So if you want a different theme, you must add the <code>TP_THEME</code> variable with the value you want. The available themes are: <code>aquamarine</code>, <code>hotline</code>, <code>space-gray</code>,<code>dark</code>, <code>plex</code> and <code>organizr</code></p> <p>Click the banners here for screenshots of the different themes: https://docs.theme-park.dev/#themes</p> <p>You can find applications that support Docker Mods installation here: https://github.com/GilbN/theme.park/tree/master/docker-mods For other installation methods check the wiki https://docs.theme-park.dev/setup/</p>","tags":["containers","dark-theme","docker","docker_mods","letsencrypt","linuxserver","nginx","proxy","reverse","skins","swag","theme-park","themes","unraid"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/","title":"How to add email notifications to Fail2ban","text":"","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#how-to-add-email-notifications-to-fail2ban","title":"How to add email notifications to Fail2ban","text":"<p>Written: 2019-09-08</p> <p>Tags</p> <p> fail2ban </p> <p> letsencrypt </p> <p> security </p> <p>Category</p> <p> backend </p> <p> security </p> <p></p> <p>Following up an my other two post about Fail2ban notifications, that you can read here: Adding ban/unban notifications from Fail2Ban to Discord! and hereAdding ban/unban notifications from Fail2Ban to Pushover! I recently got email notifications working (Thank you count_confucius) and thought I'd share how to get that working!</p>","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#adding-the-action","title":"Adding the action","text":"<p>Note</p> <p>I am using the linuxserver swag container in this guide. https://github.com/linuxserver/docker-swag</p> <p>Go into your <code>/action.d</code> folder and copy and rename <code>sendmail-whois.conf</code> to <code>sendmail-whois.local</code>. Edit the file and replace the <code>actionban</code> and add the <code>actionunban</code> with the code below:</p> <pre><code>actionban =   printf %%b \"Subject:\ud83d\udd75\ufe0f [Fail2Ban] &lt;name&gt;: BANNED IP &lt;ip&gt;! \ud83d\udd28\n              Date: `LC_ALL=C date +\"%%a, %%d %%h %%Y %%T %%z\"`\n              From: &lt;sendername&gt; &lt;&lt;sender&gt;&gt;\n              To: &lt;destination&gt;\\n\n              Hi,\\n\n              The jail &lt;name&gt; has banned ip &lt;ip&gt; after &lt;failures&gt; attempts against &lt;name&gt;.\\n\n              Here is some info about the IP: https://db-ip.com/&lt;ip&gt; \\n\n              Lines containing IP &lt;ip&gt;: \\n\n              `grep '&lt;ip&gt;' &lt;logpath&gt;` \\n\n              Regards,\\n\n              Fail2Ban\" | /usr/sbin/sendmail -t -v -H 'exec openssl s_client -quiet -tls1 -connect smtp.gmail.com:465' -au&lt;from&gt; -ap&lt;password&gt; &lt;destination&gt;\n\nactionunban = printf %%b \"Subject:\ud83d\udd14 [Fail2Ban] &lt;name&gt;: UNBANNED IP &lt;ip&gt; \u2705\n              Date: `LC_ALL=C date +\"%%a, %%d %%h %%Y %%T %%z\"`\n              From: &lt;sendername&gt; &lt;&lt;sender&gt;&gt;\n              To: &lt;destination&gt;\\n\n              Hi,\\n\n              Fail2ban has unbanned ip https://db-ip.com/&lt;ip&gt; successfully. \\n\n              Regards,\\n\n              Fail2Ban\" | /usr/sbin/sendmail -t -v -H 'exec openssl s_client -quiet -tls1 -connect smtp.gmail.com:465' -au&lt;from&gt; -ap&lt;password&gt; &lt;destination&gt;\n</code></pre> <p>NOTE: If you don't use gmail you need to update the smtp address in the code!</p> <p>Next save the file and copy and rename the <code>sendmail-common.conf</code> file to <code>sendmail-common.local</code> We have to edit this file or else we'll get a lot of errors in the Fail2ban log about failing to send jail startup and shutdown emails.</p> <p>In the <code>sendmail-common.local</code> file remove everything after <code>actionstart =</code> and <code>actionstop =</code></p> <p>If you want emails on start and stop, add the code above and just change the subject and body of the email.</p>","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#jaillocal","title":"jail.local","text":"<p>In your jail.local file add the following in the <code>[DEFAULT]</code> section:</p> <pre><code>banaction = iptables-allports\naction = %(action_mw)s[from=example@gmail.com, password=secretpassword, destination=example@gmail.com, sendername=Fail2Ban]\n</code></pre> <p>Let's break down the mail action. from = The email account it sends from. password = The password to the sender account. destination = Where you want to send the notification. sendername = Name of the sender.</p> <p>The action <code>iptables-allports</code> is needed because if you only have the send mail action it will override the action that updates the iptables! So it won't ban the IP without it.</p> <p>If you only want to add the mail notification to a specific jail you can add it to just that specific jail. On <code>[DEFAULT]</code> it will be default on every jail in <code>jail.local</code>.</p> <p>Lastly you need to restart fail2ban and try and ban yourself.</p>","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#email","title":"Email","text":"<p>The email will look like this:</p> <p></p> <p></p>","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-add-email-notifications-to-fail2ban/#_1","title":"How to add email notifications to Fail2ban","text":"","tags":["fail2ban","letsencrypt","security"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/","title":"How to route different metrics in Telegraf to different Influx databases","text":"","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#how-to-route-different-metrics-in-telegraf-to-different-influx-databases","title":"How to route different metrics in Telegraf to different Influx databases","text":"<p>Written: 2020-01-04</p> <p>Tags</p> <p> grafana </p> <p> influxdb </p> <p> telegraf </p> <p>Category</p> <p> backend </p> <p></p> <p>So, at the beginning of the last couple of years I have dropped my Influx Telegraf database containing all the host metrics gathered from the previous year. I did this because it was getting too big, and my container appdata backups where getting too big and taking too long to backup. Yes I know I could have just set a retention policy on the database and have it cleared every week, but I wanted some long term metrics like disk usage, so I could see the growth over the year.</p> <p>My Influxdb container appdata folder is currently 40GB so lets fix that.</p> <p></p>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#creating-the-long-term-database","title":"Creating the long term database","text":"<p>Log into your Influxdb instance. If you use docker you can exec in like so: <code>docker exec -it Influxdb influx</code> where <code>Influxdb</code> is the name of the container.</p> <p>Create the database with the following command: <code>CREATE DATABASE longterm_metrics</code> This creates the database <code>longterm_metrics</code> without any retention policy. If you want a retention policy on the long term metrics, say for example 1 year, you can run this:</p> <p><code>CREATE DATABASE longterm_metrics WITH DURATION 365d REPLICATION 1 SHARD DURATION 1w NAME RP_longterm_365d</code></p> <p>This will create the database and set the 365d retention policy to default for that database. If you want you can read more about replication and shards here: https://docs.influxdata.com/influxdb/v1.7/concepts/glossary/#replication-factor and https://docs.influxdata.com/influxdb/v1.7/concepts/glossary/#shard</p> <p>You can also look up retention policies with the <code>show retention policies</code> command. First select which database to use with the <code>use &lt;database&gt;</code> command and then run the <code>show retention policies</code> command like so:</p> <pre><code>&gt; use longterm_metrics\nUsing database longterm_metrics\n&gt; show retention policies\nname             duration  shardGroupDuration replicaN default\n---- -------- ------------------ -------- -------\nRP_longterm_365d 8760h0m0s 168h0m0s           1        true\n&gt;\n</code></pre>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#adding-a-new-default-retention-policy-on-the-telegraf-database","title":"Adding a new default retention policy on the Telegraf database","text":"<p>Run the following command to create a new default retention policy on the <code>telegraf</code> database:</p> <p>Danger</p> <p>This will ''reset'' the whole database!</p> <p>The data won't be gone, it's still accessible using the autogen retention policy. But the command below sets the new one as <code>default</code>, and that's what the panels normally use in Grafana.</p> <p></p> <p>If you want to migrate some data after you can check out this post https://community.influxdata.com/t/applying-retention-policies-to-existing-measurments/802/2</p> <p><code>CREATE RETENTION POLICY \"7_day_retention\" ON \"telegraf\" DURATION 1w REPLICATION 1 SHARD DURATION 1w DEFAULT</code></p> <p>This will create the retention policy called <code>7_day_retention</code> and set it as the default policy.</p> <p>After I set the new default retention policy my Influxdb appdata folder went from 40GB to 225MB :)</p> <p>Read more here: https://docs.influxdata.com/influxdb/v1.7/query_language/database_management/#retention-policy-management</p>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#sending-the-metrics-to-a-different-database","title":"Sending the metrics to a different database","text":"<p>Now in Telegraf we simply need to add an extra output that tells Telegraf to also route the metrics we want to another database.</p> <p>Note</p> <p>This won't stop telegraf from writing the metrics to the OG telegraf database, it will write to both</p> <p>Add the following to the telegraf.conf file. Note add, not replace.</p> <pre><code>[[outputs.influxdb]]\nurls = [\"http://192.168.1.34:8086\"] # required\ndatabase = \"longterm_metrics\" # required\nretention_policy = \"\"\nwrite_consistency = \"any\"\ntimeout = \"5s\"\nnamepass = [\"apcupsd\",\"disk\",\"diskio\"]\n</code></pre> <p>As I didn't add a retention policy for my long term database I have set it to use an empty string as that will use the default retention policy (autogen) of that database. If you first created the database, and then added a retention policy to that database that you want to use, you must set <code>retention_policy = \"&lt;retention_policy&gt;\"</code> to the retention policy you want. If not it will use the <code>autogen</code> retention policy as that is set to default when just running <code>create &lt;database&gt;</code></p> <p>The <code>namepass = [\"apcupsd\",\"disk\",\"diskio\"]</code> is what tells Telegraf which metrics to send to that specific database.</p> <p>After you've added the lines restart Telegraf.</p>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#adding-a-new-datasource-in-grafana","title":"Adding a new datasource in Grafana","text":"<p>Since my Telegraf datasource uses the <code>telegraf</code> database, we need to add a new data source that uses our new database.</p> <p>Click on <code>Add data source</code> and select InfluxDB.</p> <p></p> <p></p> <p>Next give the data source a name, add the URL to InfluxDB, set the database to use the new database you created and click Save &amp; Test</p> <p></p>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#updating-the-grafana-panels","title":"Updating the Grafana panels","text":"<p>Next it's just a matter of updating the Grafana panels to use the new data source.</p> <p></p> <p>If you use my Unraid System Dashboard https://grafana.com/grafana/dashboards/7233 you can just download the latest version and select the disk data source in the drop down. </p> <p>Sources:</p> <p>https://docs.influxdata.com/influxdb/v1.7/query_language/database_management</p> <p>https://docs.influxdata.com/telegraf/v1.13/administration/configuration/</p>","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server!","text":"","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-route-different-metrics-in-telegraf-to-different-influx-databases/#_1","title":"How to route different metrics in Telegraf to different Influx databases","text":"","tags":["grafana","influxdb","telegraf"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/","title":"How to setup a Cloudflare worker to show a maintenance page when the CA Backup plugin is running on Unraid","text":"","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-the-ca-backup-plugin-is-running-on-unraid","title":"How to setup a Cloudflare worker to show a maintenance page when the CA Backup plugin is running on Unraid","text":"<p>Written: 2019-08-14</p> <p>Tags</p> <p> backup </p> <p> cloudflare </p> <p> maintenance </p> <p> script </p> <p> unraid </p> <p> wordpress </p> <p>Category</p> <p> frontend </p> <p></p> <p>Since I use the CA Backup/Restore plugin every night my blog site will some times show the Cloudflare 523 error: origin is unreachable for around 1 hour before the plugin finishes and starts all my docker containers up again. So since that has been a minor annoyance for some time, I decided to look into how I could set up a maintenance page automatically when the backup starts.</p> <p>Note: This wouldn't have been an issue if the \"Always Online\" fuctionality worked on my site</p> <p>So after some googling I found this great resource on how to route people to their maintenance page while they are doing maintenance. The javascript returns the maintenance page if you are not calling from a trusted IP. Now Since that is something I don't need I have removed that function so you will be routed to the page regardless with the code below.</p> <p>This is all made possible by using the Cloudflare API and Cloudflare workers. We will need to create a worker and setup a route for it.</p>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#creating-a-worker","title":"Creating a worker","text":"<p>On your Cloudflare dashboard click on Workers and go through the first time setup if you haven't done that yet. Next click on <code>Manage Workers</code> and <code>Create a Worker</code></p> <p> Give your worker a name and paste the code below. Edit the html part to say what you want. Click <code>Save and Deploy.</code> After a minute or so you should be able to visit the page the worker is deployed on.</p> <p> After you've created the worker, go back to the main page and click on <code>Add route</code></p> <p></p> <p>Set the route to a subdomain that doesnt point to your site. I'm using <code>maintenance.technicalramblings.com</code> Remember to add the DNS record before you create the route. The subdomain you choose shouldn't be something you use as that will disrupt that domain. So I just added something that made sense to me. The subdomains only purpose is to be a placeholder for the maintenance page when the nightly backups aren't running.</p> <p>The way I have this setup is that I am using the API to update the \"route pattern\" that the worker is using. So when the backup starts it will run a script that updates the route pattern to <code>technicalramblings.com/*</code> and sets the route to use the <code>maintenance</code> worker. This will display the page in the screenshot below when someone is trying to access my blog.</p> <p></p> <p>When the backup is finished a script will run and it will change the \"route pattern\" back to <code>maintenance.technicalramblings.com/*</code> I have also added another worker that I called <code>up</code> So when everything is back up the maintenance subdomain will display this:</p> <p></p> <p>The <code>up</code> script is identical with only the html part changed. Its not really needed, but I wanted the maintenance page to display something different when the backup was not running in case someone stumbled over the subdomain.</p> <pre><code>addEventListener('fetch', event =&gt; {\nevent.respondWith(handleRequest(event.request))\n})\n\n/**\n * Respond to the request\n * @param {Request} request\n */\nasync function handleRequest(request) {\n\nlet modifiedHeaders = new Headers()\n\nmodifiedHeaders.set('Content-Type', 'text/html')\nmodifiedHeaders.append('Pragma', 'no-cache')\n\nreturn new Response(maintenancepage, {headers: modifiedHeaders})\n}\nlet maintenancepage = `\n\n&lt;!doctype html&gt;\n&lt;title&gt;Site Maintenance&lt;/title&gt;\n&lt;style&gt;\n  body { \n        text-align: center; \n        padding: 150px; \n        background: url('https://raw.githubusercontent.com/gilbN/Nostromo/master/blog/Senja-death-star.jpg') no-repeat center center fixed; \n        background-size: cover;\n        -webkit-background-size: cover;\n        -moz-background-size: cover;\n        -o-background-size: cover;\n      }\n\n    .content {\n        background-color: rgba(255, 255, 255, 0.75); \n        background-size: 100%;      \n        color: inherit;\n        padding: 1px 100px 10px 100px;\n        border-radius: 15px;        \n    }\n\n  h1 { font-size: 40pt;}\n  body { font: 20px Helvetica, sans-serif; color: #333; }\n  article { display: block; text-align: left; width: 75%; margin: 0 auto; }\n  a:hover { color: #333; text-decoration: none; }\n&lt;/style&gt;\n\n&lt;article&gt; \n  &lt;div class=\"background\"&gt;\n    &lt;div class=\"content\"&gt;\n      &lt;h1&gt;We&amp;rsquo;ll be right back!&lt;/h1&gt;\n        &lt;p&gt;We're very sorry for the inconvenience but we&amp;rsquo;re performing maintenance.&lt;/p&gt;\n        &lt;p&gt;Maintenance is performed between &lt;strong&gt;3AM&lt;/strong&gt; to &lt;strong&gt;4AM&lt;/strong&gt; &lt;strong&gt;UTC&lt;/strong&gt;.&lt;/p&gt;\n        &lt;p&gt;Please check back soon...&lt;/p&gt;\n        &lt;p&gt;You can use &lt;span style=\"color: #000000;\"&gt;&lt;strong&gt;&lt;a style=\"color: #000000;\" href=\"https://cachedview.com/\"&gt;https://cachedview.com/&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt; in the mean time.&lt;/p&gt;\n        &lt;p&gt;&amp;mdash; &lt;B&gt;GilbN&lt;/B&gt;&lt;/p&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/article&gt;\n`;\n</code></pre>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#ca-backup-scripts","title":"CA Backup Scripts","text":"<p>So, for this to all work automatically we need to add a couple of start/stop scripts to the CA Backup plugin. But before we can do that we need to get the ID of the route we just created.</p> <p>We can only get the ID by using the Cloudflare API. So run the curl command below to get the route ID you created. Remember to change the zone, API key and email.</p> <pre><code>curl -X GET \"https://api.cloudflare.com/client/v4/zones/YOUR-ZONE-ID/workers/routes/\" \\\n-H \"X-Auth-Email: YOUR@CLOUDFLARE-EMAIL.com\" \\\n-H \"X-Auth-Key: YOUR-API-KEY\"\n</code></pre> <p>The Zone ID is found on the overview page of the domain you want to use, and the API Key is found on the api tokens page https://dash.cloudflare.com/profile/api-tokens Use the global token.</p> <p></p> <p></p> <p>The command should output something like this:</p> <pre><code>{\n\"result\": [\n{\n\"id\": \"8998sfd23sd48ds0g5jk3s5sdhd098\",\n\"pattern\": \"maintenance.technicalramblings.com/*\",\n\"script\": \"maintenance\"\n}\n],\n\"success\": true,\n\"errors\": [],\n\"messages\": []\n}\n</code></pre> <p>The id is the <code>route id</code> we need to use in the start/stop scripts, so save that.</p>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#stop-script","title":"Stop script","text":"<p>(Runs when CA Backup starts. It's called stop script because it runs when stopping the containers)</p> <pre><code>#!/bin/bash\nemail='EXAMPLE@DOMAIN.COM'\napikey='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nzone_id='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nroute_id='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nroute_pattern='technicalramblings.com/*'\nworker='maintenance'\n\ncurl -X PUT \"https://api.cloudflare.com/client/v4/zones/\"$zone_id\"/workers/routes/\"$route_id\"\" \\\n-H \"X-Auth-Email: \"$email\"\" \\\n-H \"X-Auth-Key: \"$apikey\"\" \\\n-H \"Content-Type: application/json\" \\\n--data '{\"pattern\":\"'\"$route_pattern\"'\",\"script\":\"'\"$worker\"'\"}'\n</code></pre> <p>Update the scripts to use your api key, route id and zone id ect. You can try the script by setting the domain variable to a test domain (Must be the same domain as the zone ID ). Note: the pattern I use has a <code>wildcard</code> at the end so it will match any url from my blog. You can read more about the matching behavior here https://workers.cloudflare.com/docs/reference/workers-concepts/routes/</p>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#start-script","title":"Start script","text":"<p>(Runs when CA Backup is finished and the containers have been started):</p> <pre><code>#!/bin/bash\nemail='EXAMPLE@DOMAIN.COM'\napikey='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nzone_id='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nroute_id='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nroute_pattern='maintenance.technicalramblings.com/*'\nworker='up'\n\ncurl -X PUT \"https://api.cloudflare.com/client/v4/zones/\"$zone_id\"/workers/routes/\"$route_id\"\" \\\n-H \"X-Auth-Email: \"$email\"\" \\\n-H \"X-Auth-Key: \"$apikey\"\" \\\n-H \"Content-Type: application/json\" \\\n--data '{\"pattern\":\"'\"$route_pattern\"'\",\"script\":\"'\"$worker\"'\"}'\n</code></pre> <p>Next create the scripts at your desired location. <code>nano start.sh</code> paste the contents, save and run <code>chmod +x start.sh</code> Test the script with <code>./start.sh</code> Do the same for the stop script</p> <p>Add the paths in the CA Backup plugin settings.</p> <p></p>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-cloudflare-worker-to-show-a-maintenance-page-when-ca-backup-plugin-is-running/#_1","title":"How to setup a Cloudflare worker to show a maintenance page when the CA Backup plugin is running on Unraid","text":"<p>Sources:</p> <p>https://www.resdevops.com/2018/03/20/cloudflare-workers-maintenance-mode-static-page/</p> <p>https://api.cloudflare.com/#worker-routes-update-route</p>","tags":["backup","cloudflare","maintenance","script","unraid","wordpress"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/","title":"How to setup a Ghost blog with swag and MariaDB on Unraid","text":"","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#how-to-setup-a-ghost-blog-with-swag-and-mariadb-on-unraid","title":"How to setup a Ghost blog with swag and MariaDB on Unraid","text":"<p>Written: 2020-02-03</p> <p>Tags</p> <p> blog </p> <p> database </p> <p> docker </p> <p> geoblock </p> <p> ghost </p> <p> letsencrypt </p> <p> mariadb </p> <p> nginx </p> <p> proxy </p> <p> swag </p> <p> unraid </p> <p>Category</p> <p> frontend </p> <p></p> <p>Now, I don't really have any issues with Wordpress, I like it. But It's always fun to try something new to see if you're missing out. The setup process is fairly similar to Wordpress except I will be using the Ghost docker container this time. There is also some custom setup you might have to do with the Ghost template to make it work.</p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#what-is-ghost","title":"What is Ghost","text":"<p>Info</p> <p>Ghost is a free and open source blogging platform written in JavaScript and distributed under the MIT License, designed to simplify the process of online publishing for individual bloggers as well as online publications.</p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#mariadb-installation","title":"MariaDB Installation","text":"<p>Installing MariaDB is very straight forward. Go to the \"Apps\" tab and search for mariadb and click install. If you already have mariadb installed and are using it with another application you can scroll down to the <code>Create the ghost database manually</code> part.</p> <ol> <li>Choose your host port and your <code>MYSQL Root</code> password.</li> <li>Add the database name variable. <code>MYSQL_DATABASE</code></li> <li>Add the database user variable. <code>MYSQL_USER</code></li> <li>Add the user password variable. <code>MYSQL_PASSWORD</code></li> </ol> <p></p> <p></p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#optional-create-the-ghost-database-manually","title":"Optional: Create the ghost database manually","text":"<ol> <li>Open terminal and exec into the container with **<code>docker exec -it mariadb bash</code>**or use the console shortcut on the Dashboard page.</li> <li>Log into mysql with user root and the password you chose. **<code>mysql -uroot -p</code>**enter your password.</li> </ol> <p>The output will look like this:</p> <pre><code>root@Nostromo:~# docker exec -it mariadb bash\nroot@ac436a71f4be:/# mysql -uroot -p\nEnter password:\nWelcome to the MariaDB monitor. Commands end with ; or g.\nYour MariaDB connection id is 3\nServer version: 10.1.30-MariaDB-1~xenial mariadb.org binary distribution\n\nCopyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or 'h' for help. Type 'c' to clear the current input statement.\n\nMariaDB [(none)]\n</code></pre> <p>Next up is creating the database. (Remember to end all queries with a semicolon)</p> <ol> <li>Start with creating a user for the database.<code>CREATE USER 'user' IDENTIFIED by 'password';</code>Where 'user' is your username and 'password' is the password you want for the new user. The ouput will be like this.</li> </ol> <pre><code>MariaDB [(none)]&gt; CREATE USER 'ghost' IDENTIFIED by 'ghost';\nQuery OK, 0 rows affected (0.01 sec)\n</code></pre> <ol> <li>Create the database with <code>CREATE DATABASE IF NOT EXISTS ghost;</code></li> </ol> <pre><code>MariaDB [(none)]&gt; CREATE DATABASE IF NOT EXISTS ghost;\nQuery OK, 1 row affected (0.00 sec)\n</code></pre> <ol> <li>Give the user permissions to the database with <code>GRANT ALL PRIVILEGES ON ghost.* TO 'ghost' IDENTIFIED BY 'ghost';</code></li> </ol> <pre><code>MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON ghost.* TO 'ghost' IDENTIFIED BY 'ghost';\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre> <p>Then quit mysql with <code>quit</code> and exit from the container by issuing the command <code>exit</code></p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#swagletsencrypt","title":"swag/Letsencrypt","text":"<p>If you already have swag setup you can just skip down to the nginx part.</p> <p>For first time installation I strongly recommend reading this excellent guide by aptalca https://blog.linuxserver.io/2019/04/25/letsencrypt-nginx-starter-guide/</p> <p>It covers all the basics on setting up this container. There's no point for me invent the wheel again. For troubleshooting the container have a look at this https://blog.linuxserver.io/2019/07/10/troubleshooting-letsencrypt-image-port-mapping-and-forwarding/.</p> <p>Warning</p> <p>TTL differs from each provider, some has a minimum 60 minutes before DNS propagates and others have 1 minute. So it might take a while before https://yourdomain.com works.</p> <p>If you already have swag setup and working with a domain and want to use another domain for your ghost site you can do that by using the <code>EXTRA_DOMAINS</code> variable.</p> <ol> <li> <p>Click on Add another Path, Port or Variable</p> </li> <li> <p>Add these values:</p> </li> </ol> <p>Config Type: Variable</p> <p>Name: Extra domain</p> <p>Key: EXTRA_DOMAINS</p> <p>Value: yourotherdomain.com, ghost.yourotherdomain.com</p> <p></p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#nginx","title":"Nginx","text":"<p>Go to the swag appdata location. Find the nginx folder and either create a new <code>ghost.conf</code> file in the \"site-conf\" folder(domains and subdomains only) or use the proxy-confs folder and create a file with the correct naming scheme(<code>ghost.subdomain.conf</code> or <code>ghost.subfolder.conf</code>). I recommend using notepad++ if you are editing the files on a windows machine.</p> <p>I've made a PR on the linuxserver/reverse-proxy-confs repo, so the files might already be there depending on when you read this. https://github.com/linuxserver/reverse-proxy-confs/pull/118</p> <p>If you want to Geo block your site read more here</p> <p>Select the config you want below:</p> <p>Info</p> <p>If you are using docker dns in you reverse proxy remember to change the Ghost container name to <code>ghost</code> lower case! Docker DNS does not like Uppercase letters.</p> <p>Subdomain</p> <pre><code>server {\nlisten 443 ssl;\nlisten [::]:443 ssl;\n\nserver_name ghost.*;\n\ninclude /config/nginx/ssl.conf;\n\nclient_max_body_size 0;\n\n# enable for ldap auth, fill in ldap details in ldap.conf\n#include /config/nginx/ldap.conf;\n\nlocation / {\n#enable the next two lines for http auth\n#auth_basic \"Restricted\";\n#auth_basic_user_file /config/nginx/.htpasswd;\n\n# enable the next two lines for ldap auth\n#auth_request /auth;\n#error_page 401 =200 /login;\n\ninclude /config/nginx/proxy.conf;\nresolver 127.0.0.11 valid=30s;\nset $upstream_ghost ghost;\nproxy_pass http://$upstream_ghost:2368;\nproxy_redirect off;\n}\n}\n</code></pre> <p>Subfolder</p> <pre><code>location /blog {\nresolver 127.0.0.11 valid=30s;\nset $upstream_ghost ghost;\nproxy_pass http://$upstream_ghost:2368;\ninclude /config/nginx/proxy.conf;\nproxy_redirect off;\n}\n</code></pre> <p>Note</p> <p>Make sure you are using a subdirectory in your ghost config file. https://ghost.org/docs/concepts/config/#url And the subdirectory <code>/ghost/</code> is by default used for the admin page. See https://ghost.org/docs/concepts/config/#admin-url</p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#ghost","title":"Ghost","text":"<p>Ghost was fairly simple to install, but I had to do some modifications to the Unraid container template.</p> <p>Database Port: The template does not specify a database port for your SQL server. So I had to add the <code>database__connection__port</code> variable as I don't use the default 3306 port.</p> <p>Mail Host: The template does not have the <code>mail__options__host</code> variable needed for Mailgun EU or custom mail setup i.e. Gmail. For example: <code>smtp.eu.mailgun.org</code> or <code>smtp.gmail.com</code></p> <p>Mail Port: The template does not have the <code>mail__options__port</code> variable. This is needed if you are using Gmail for example. Set it to <code>465</code></p> <p>So for a Gmail setup you need only to set the Mail service to <code>Gmail</code> and add the necessary variables. Note: The <code>Username and Password for Mailgun</code> is just the mail username and password variables. Doesn't really have anything to do with Mailgun.</p> <p></p> <p>For a Mailgun setup see the Ghost docs: https://ghost.org/docs/concepts/config/#configure-mail-with-mailgun</p> <p>The rest is just filling out the different variables.</p> <p>Remember to a subdirectory in the URL field if you hare using that. For example: <code>https://technicalramblings.com/blog</code> or <code>https://ghost.technicalramblings.com/blog</code></p> <p></p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#make-the-site-private","title":"Make the site private","text":"<p>A nice feature Ghost has is a setting which can make the site private with password protection. Just go into the general settings and enable it under advanced settings.</p> <p></p>","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server!","text":"","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-a-ghost-site-with-letsencrypt-and-mariadb-on-unraid/#_1","title":"How to setup a Ghost blog with swag and MariaDB on Unraid","text":"","tags":["blog","database","docker","geoblock","ghost","letsencrypt","mariadb","nginx","proxy","swag","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/","title":"How to setup Grafana, InfluxDB and Telegraf to monitor your unRAID system.","text":"","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system","title":"How to setup Grafana, InfluxDB and Telegraf to monitor your unRAID system.","text":"<p>Written: 2019-07-21</p> <p>Tags</p> <p> database </p> <p> docker </p> <p> grafana </p> <p> influxdb </p> <p> telegraf </p> <p> unraid </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p></p> <p>I have for some time shared my Unraid System dashboard over at Grafana.com but never really had the time to make a quick write up on how to set it all up. So this will try to do just that. This guide will make it so you will be able to monitor cpu usage, cpu temps, network stats, ram usage and much more by simply importing a dashboard.</p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#how-it-works","title":"How it works","text":"<p>In getting all this setup, there are 3 main moving parts. Telegraf, InfluxDB and Grafana. Telegraf is what collects all the different system metrics and outputs it to an InfluxDB database that Grafana uses to visualize everything with pretty graphs and bars.</p> <p></p> <p>This is a pretty simplified explanation and you can read more here: Telegraf, InfluxDB, Grafana</p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#installing-influxdb","title":"Installing Influxdb","text":"<p>Search for <code>influxdb</code> in Community Apps and install it using the default template. Select your appdata path and host ports if the default ones are taken. There is no other setup than just installing the container.</p> <p>Don't use the latest tag</p> <p>The <code>:latest</code> tag will run InfluxDB V2! This guide was written for v1.8. Change the tag to <code>:1.8.x</code> for it to work!</p> <p></p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#installing-telegraf","title":"Installing Telegraf","text":"<p>Do the same here, just search for the container in Community Apps and use the default template settings. Set the appdata location to where you want it, but don't click install just yet!</p> <p>Don't use the latest tag</p> <p>The <code>:latest</code> tag will run a version that you can't install extra packages into! Change the tag to <code>telegraf:1.20.2</code> for it to work!</p> <p>Network</p> <p>Make sure the container uses Host networking!</p> <p>Warning</p> <p>This container wont start unless the <code>telegraf.conf</code> file already exists on the host. (Host path 7) Do not install the container before you follow the steps below!</p> <p>Troubleshooting</p> <p>If you happened to start the container without doing the steps below first you will need to delete the folder it created instead of mounting the file. Go to the location you selected for the appdata and delete the <code>telegraf.conf</code> folder. Next follow the steps below.</p> <ol> <li> <p>Download the file and place it in the location you want the telegraf appdata to be. e.g. <code>/mnt/cache/appdata/telegraf/telegraf.conf</code> The default config file can be downloaded here: https://raw.githubusercontent.com/influxdata/telegraf/master/etc/telegraf.conf</p> </li> <li> <p>Next you need to edit the <code>telegraf.conf</code> file. Go to the location you saved the file and scroll down to <code>OUTPUT PLUGINS</code> which should be around line 90-120.Uncomment (Remove #) the http url line for InfluxDB and the \"database\" line, like so:</p> </li> </ol> <pre><code># urls = [\"unix:///var/run/influxdb.sock\"]\n# urls = [\"udp://127.0.0.1:8089\"]\nurls = [\"http://192.168.1.34:8086\"]\n</code></pre> <p>192.168.1.34 is the IP address to my Unraid server and 8086 is the default InfluxDB port that runs the InfluxDB HTTP service.</p> <ol> <li> <p>Next we need to setup the input plugins. A lot of these are already enabled but we need to add a couple so that all the panels on the Grafana dashboard will work.</p> </li> <li> <p>Uncomment the following plugins and lines:</p> <ol> <li>HDD temps/stats: <code>[[inputs.smart]]</code></li> <li>CPU temps: <code>[[inputs.sensors]]</code></li> <li>Network: <code>[[inputs.net]]</code> and <code>interfaces = [\"eth0\"]</code> ect</li> <li>Netstat: <code>[[inputs.netstat]]</code></li> <li>Docker: <code>[[inputs.docker]]</code> and <code>endpoint = \"unix:///var/run/docker.sock\"</code></li> <li>UPS: <code>[[inputs.apcupsd]]</code></li> </ol> </li> <li> <p>Now go back to the install page of telegraf and add the following into the <code>Post Arguments</code> input field:<code>/bin/sh -c 'apt update &amp;&amp; apt install -y smartmontools &amp;&amp; apt install -y lm-sensors &amp;&amp; telegraf' --user 0</code> To be able to see this field we need to click on the <code>Advanced View</code> button. This will install <code>smartmontools</code> and without it you won't be able to get the S.M.A.R.T statistics. Note: If you also want to add IPMI and nvme stats you can add the following: <code>/bin/sh -c 'apt update &amp;&amp; apt install -y smartmontools &amp;&amp; apt install -y lm-sensors &amp;&amp; apt install -y nvme-cli &amp;&amp; apt install -y ipmitool &amp;&amp; telegraf'</code></p> </li> </ol> <p>Alpine</p> <p>If you use the alpine tag use these commands instead.\"</p> <p></p> <p><code>/bin/sh -c 'apk update &amp;&amp; apk add smartmontools &amp;&amp; apk add lm-sensors lm-sensors-detect perl &amp;&amp; telegraf'</code></p> <p>With IPMI and nvme: <code>/bin/sh -c 'apk update &amp;&amp; apk add smartmontools &amp;&amp; apk add lm-sensors lm-sensors-detect perl &amp;&amp; apk add nvme-cli &amp;&amp; apk add ipmitool &amp;&amp; telegraf'</code></p> <p></p> <p></p> <p>After editing the telegraf.conf and adding the post arguments you can start the Telegraf container. Telegraf will automatically create a database called <code>telegraf</code> when started for the first time with the influxdb plugin activated.</p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#installing-grafana","title":"Installing Grafana","text":"<p>Installing Grafana is also quite simple. Chose your host port for the webUI and add your unraid URL and admin password to the container settings.</p> <p></p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#configuring-grafana","title":"Configuring Grafana","text":"<p>After the installation is finished go to the WebUI. (http://unraidIP:3000) and log in with username <code>admin</code> and the password you chose. You should then see this on you screen:</p> <p>Click on <code>Add data source</code> and select InfluxDB.</p> <p></p> <p></p> <p>Next give the data source a name(I named it Telegraf), add the URL to InfluxDB, enter the database to use (telegraf) and set the HTTP Method to POST. This is helpful on some of the more heavy queries. Grafana will use the default username and password for Influxdb (root root), if you have added a user you will need to add that too. Next click Save &amp; Test</p> <p></p> <p>If all your settings are correct you should see this message.</p> <p></p> <p>Next import the dashboard by hovering over the + icon and selecting Import</p> <p></p> <p>Paste the dashboard ID 7233 and click Load Give it a name and UID, select the database in the drop down and click Import.</p> <p></p> <p>Next, select the correct values on the menu at the top.</p> <p></p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#some-assembly-needed","title":"Some assembly needed","text":"<p>You should now already see most of the panels working and displaying stats. But there will be some panels where you need to select some values in the dropdowns at the top. Like Cache Devices. On the Cache Devices (diskio) dropdown you can select multiple devices, and it will add them to the Cache Read/Write panel.</p> <p></p> <p>The Interval text box is the interval that is set in <code>telegraf.conf</code> The default value is 10 seconds, but if you changed this you can update it here.</p> <p>To update the drive names on the Storage Consumption panel, edit the panel and go to the Field menu. There you will can add the different Value Mappings for the different drive paths. See the video below.</p> <p></p> <p>And that's about it! This should get you going on adding or creating awesome dashboards for you Unraid system. There are tons of different dashboards on grafana.com to get inspiration from. My dashboard is far from the best one out there, so please share your awesome dashboards in the comment section or on Discord!</p> <p>Not UUD</p> <p>The dashboard used in this guide is not the Ultimate Unraid Dashboard seen from the offical unraid blog post. You can find that dashboard and the extra instructions in the link below!</p> <p>UUD: https://forums.unraid.net/topic/96895-ultimate-unraid-dashboard-uud/</p> <p>And if you're wondering why my Grafana page looks different from the stock theme you can take a look here: https://github.com/gilbN/theme.park</p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#optional-adding-ups-stats","title":"Optional: Adding UPS stats","text":"<p>On the top of my dashboard I have UPS stats, now if you don't have a UPS (You should by the way) you can just delete those panel. But if you have a UPS that's compatible with Unraid you can check out these guides:</p> <p>Telegraf UPS guide</p> <p>APCUPSd UPS Guide</p> <p>NUT UPS Guide</p>","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server!","text":"","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/how-to-setup-grafana-influxdb-and-telegraf-to-monitor-your-unraid-system/#_1","title":"How to setup Grafana, InfluxDB and Telegraf to monitor your unRAID system.","text":"","tags":["database","docker","grafana","influxdb","telegraf","unraid"]},{"location":"blog/howto-setup-gitlab-to-use-rack-attack-to-ban-abusive-ips/","title":"How to setup GitLab to use Rack Attack and ban abusive IPs and rate limit requests","text":"","tags":["fail2ban","gitlab","rack-attack","rate-limit","security"]},{"location":"blog/howto-setup-gitlab-to-use-rack-attack-to-ban-abusive-ips/#how-to-setup-gitlab-to-use-rack-attack-and-ban-abusive-ips-and-rate-limit-requests","title":"How to setup GitLab to use Rack Attack and ban abusive IPs and rate limit requests","text":"<p>Written: 2019-04-19</p> <p>Tags</p> <p> fail2ban </p> <p> gitlab </p> <p> rack-attack </p> <p> rate-limit </p> <p> security </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p> security </p> <p></p> <p>So, for anyone that's running the GitLab Docker container, I got real IPs to pass through to the logs and was then able to setup Rack Attack (similar to Fail2Ban), which is included by default, to ban abusive IPs and rate limit failed login attempts.</p> <p>Note: Rack attack does not ban IPs that fail to login on you GitLab, it bans IPs that fail to authenticate after x attempts when using git http authentication!_</p> <p>The first step is getting real IPs to pass through to the GitLab container logs. The first thing that you will need to do is edit the <code>gitlab.rb</code> file from inside the container itself. You can do this by first execing into the container: <code>docker exec -it gitlab /bin/bash</code> Where <code>gitlab</code> is the container name, and then open the file with a text editor (vim is installed): <code>:/# vim /etc/gitlab/gitlab.rb</code> Next, you will need to find the following lines:</p> <pre><code>#nginx['real_ip_trusted_addresses'] = []\n#nginx['real_ip_header'] = \n</code></pre> <p>Uncomment the lines and then change them to something like this:</p> <pre><code>nginx['real_ip_trusted_addresses'] = ['172.17.0.0/16','172.18.0.0/16','172.19.0.0/16','172.20.0.0/16','192.168.1.0/24']\nnginx['real_ip_header'] = 'X-Forwarded-For'\n</code></pre> <p>You will need to modify the IP address ranges to make your network(s). Once you're done, save the changes and exit the text editor. Now you need to reconfigure gitlab, while still inside the container, with the following command: <code>gitlab-ctl reconfigure</code> It should go through and reconfigure everything and add the changes you just made. You can verify that the changes were added with the following <code>grep</code> command: <code>grep real_ip /var/opt/gitlab/nginx/conf/gitlab-http.conf</code> The output should look similar to this:</p> <pre><code>:/# grep real_ip /var/opt/gitlab/nginx/conf/gitlab-http.conf\nreal_ip_header X-Forwarded-For;\nset_real_ip_from 172.17.0.0/16;\nset_real_ip_from 172.18.0.0/16;\nset_real_ip_from 172.19.0.0/16;\nset_real_ip_from 172.20.0.0/16;\nset_real_ip_from 192.168.1.0/24;\n</code></pre> <p>With these changes now in place you should be able to see real IP addresses in the <code>/log/nginx/gitlab_access.log</code> the <code>/log/gitlab-rails/application.log</code> and the <code>/log/gitlab-rails/production.log</code> . I have <code>/mnt/user/Docker/gitlab-ce</code> set as my application data directory for the GitLab container so the full path for me is <code>/mnt/user/Docker/gitlab-ce/log/nginx/gitlab_access.log</code>.</p> <p>Now that real IPs are getting logged you can enable and configure the built-in Rack Attack utility to find and block abusive IPs and rate limit failed login attempts. You will need to exec back into the container if you logged out: <code>docker exec -it gitlab /bin/bash</code> And open the <code>gitlab.rb</code> file again: <code>:/# vim /etc/gitlab/gitlab.rb</code> Find the following section and uncomment it:</p> <pre><code># gitlab_rails['rack_attack_git_basic_auth'] = {\n#   'enabled' =&gt; true,\n#   'ip_whitelist' =&gt; [\"127.0.0.1\"],\n#   'maxretry' =&gt; 5,\n#   'findtime' =&gt; 60,\n#   'bantime' =&gt; 3600\n# }\n</code></pre> <p>You will need to add the IP ranges you wish to white-list, most likely the same list that you setup for the real_ip configuration, so you don't accidentally ban yourself. It will end up looking something like this:</p> <pre><code>gitlab_rails['rack_attack_git_basic_auth'] = {\n'enabled' =&gt; true,\n  'ip_whitelist' =&gt; [\"127.0.0.1\", \"172.17.0.0/16\", \"172.18.0.0/16\", \"172.19.0.0/16\", \"172.20.0.0/16\", \"192.168.1.0/24\"],\n  'maxretry' =&gt; 5,\n  'findtime' =&gt; 60,\n  'bantime' =&gt; 3600\n}\n</code></pre> <p>Next you need to reconfigure GitLab again: <code>gitlab-ctl reconfigure</code> Once the reconfiguration is done you can have someone or yourself test the functionality and try to git clone with invalid credentials. Once they're blocked, they should see a \"fatal: unable to access\" message like below.</p> <pre><code>gilbn@DESKTOP-UP9572O MINGW64 /f/github\n$ git clone https://gitlab.domain.com/gilbn/testproject\nCloning into 'testproject'...\nremote: HTTP Basic: Access denied\nfatal: Authentication failed for 'https://gitlab.domain.com/gilbn/testproject.git/'\n\ngilbn@DESKTOP-UP9572O MINGW64 /f/github\n$ git clone https://gitlab.domain.com/gilbn/testproject\nCloning into 'testproject'...\nremote: HTTP Basic: Access denied\nfatal: Authentication failed for 'https://gitlab.domain.com/gilbn/testproject.git/'\n\ngilbn@DESKTOP-UP9572O MINGW64 /f/github\n$ git clone https://gitlab.domain.com/gilbn/testproject\nCloning into 'testproject'...\nremote: Forbidden\nfatal: unable to access 'https://gitlab.domain.com/gilbn/testproject/': The requested URL returned error: 403\n</code></pre> <p>In addition to them or you seeing that message , you can check the <code>production.log</code> file in the appdata directory for the container: <code>grep -i blacklist /mnt/user/Docker/gitlab-ce/log/gitlab-rails/production.log</code> If the IP was blocked, you should see something similar to the following:</p> <pre><code>root@Nostromo:# grep -i blacklist /mnt/user/Docker/gitlab-ce/log/gitlab-rails/production.log \nRack_Attack: blacklist 46.246.123.33 GET /gilbn/testproject/info/refs?service=git-upload-pack\n</code></pre> <p>For rate limit throttling on failed logins you will see:</p> <pre><code>:~# grep -i rack_attack /home/gitlab/logs/gitlab-rails/production.log\nRack_Attack: throttle 82.37.176.202 POST /users/sign_in\n</code></pre> <p>And the user will see a <code>Retry Later</code> message in their browser.</p> <p>Note: The rate limit does not follow the blacklist <code>bantime</code>. The rate limit can be adjusted on the rate limit lines in the <code>gitlab.rb</code> file.</p> <pre><code>#gitlab_rails['rate_limit_requests_per_period'] = 10\n#gitlab_rails['rate_limit_period'] = 60\n</code></pre> <p>Default is 10 requests in a 60 second period.</p> <p>If you want to add fail2ban on your login page you can use this filter: https://gist.github.com/pawilon/238c278d3c6c4669771eb81b03264acd</p> <p>Written by Tronyx - https://github.com/christronyxyocum Edited by GilbN</p>","tags":["fail2ban","gitlab","rack-attack","rate-limit","security"]},{"location":"blog/howto-setup-gitlab-to-use-rack-attack-to-ban-abusive-ips/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["fail2ban","gitlab","rack-attack","rate-limit","security"]},{"location":"blog/migrating-view-history-between-two-plex-servers-avoiding-negative-unwatched-count/","title":"Migrating/Merging View History between two Plex Servers - Avoiding Negative Unwatched Count","text":"","tags":["database","plex"]},{"location":"blog/migrating-view-history-between-two-plex-servers-avoiding-negative-unwatched-count/#migratingmerging-view-history-between-two-plex-servers-avoiding-negative-unwatched-count","title":"Migrating/Merging View History between two Plex Servers - Avoiding Negative Unwatched Count","text":"<p>Written: 2019-04-07</p> <p>Tags</p> <p> database </p> <p> plex </p> <p>Category</p> <p> backend </p> <p></p> <p>Every so often you may put yourself in a situation where you're forced to reinstall Plex. Regrettably, Plex has no built-in functionality for database back-up and migration. This may seem logical, as it is typically unimportant to backup and restore posters and folder matches. However, there is one piece of database information that is worth restoring from previous servers: the view history. This information tells the Plex Media Server instance what has been marked as Played/Unplayed. It also contains some extra information such as user ratings.</p> <p>But the issue arises when merging into a server that isn't a clean install (absolutely no watch history). In this scenario, you may be faced with errors such as <code>Error: near line 2319: UNIQUE constraint failed:metadata_item_settings.id</code>, and you may see negative unplayed counts within Plex.</p> <p></p> <p>Migrating watch history while avoiding these issues can be done in six easy steps.</p>","tags":["database","plex"]},{"location":"blog/migrating-view-history-between-two-plex-servers-avoiding-negative-unwatched-count/#part-one-merging-databases","title":"Part One: Merging Databases","text":"<p>1) Locate the databases directory for the Plex install that contains the view history you wish to save. This will be found in <code>./Plex Media Server/Plug-in Support/Databases/</code></p> <p>The default location of this Plex Media Server folder will vary depending on operating system. For more directories see Where is the Plex Media Server data directory located? Here's the location for a few common operating systems.</p> <p>Windows: <code>%LOCALAPPDATA%</code> OSX:<code>~/Library/ApplicationSupport/</code> Linux: <code>$PLEX_HOME/Library/ApplicationSupport/</code> Debian: <code>/var/lib/plexmediaserver/Library/Application Support/</code> FreeBSD: <code>/usr/local/plexdata/</code> FreeNAS: <code>/var/db/plexdata/</code> Unraid Docker (Binhex): <code>/mnt/cache/appdata/binhex-plex/</code></p> <p>When you locate this directory, navigate to it via a terminal. This can be done with cd on Linux and dir on Windows.</p> <p>2) Ensure that sqlite3 is installed on the host operating system by typing <code>sqlite3 -version</code> into your terminal. If an error shows indicating that it is not installed, install SQLite3 through your package manager or through this link.</p> <p>3) Put the view history into a file called viewhistory.sql. This can be done via typing the following command while in the Databases directory:</p> <pre><code>echo \".dump metadata_item_settings\" | sqlite3 com.plexapp.plugins.library.db | grep -v TABLE | grep -v INDEX &gt; viewhistory.sql\n</code></pre> <p>4) Move viewhistory.sql to the databases directory for the Plex install that you're migrating data into.</p> <p>5) Merge view history data from the old server into the new server. This can by done by running the following:</p> <pre><code>cat viewhistory.sql | sqlite3 com.plexapp.plugins.library.db\n</code></pre> <p>Do not be alarmed if you see a _<code>UNIQUE constraint failed</code>_error. This will be fixed in the next step.</p>","tags":["database","plex"]},{"location":"blog/migrating-view-history-between-two-plex-servers-avoiding-negative-unwatched-count/#part-two-removing-the-duplicates","title":"Part Two: Removing the Duplicates","text":"<p>6) Remove duplicate database entries that cause negative a view count. Please note, it is highly recommended to create a backup of <code>com.plexapp.plugins.library.db</code> before attempting to modify it.</p> <p>If the server you're merging view states to is not perfectly clean (a server with no watch history), or if you received <code>UNIQUE constraint failed</code> in the previous steps then you must run the following command in the current directory:</p> <pre><code>sqlite3 com.plexapp.plugins.library.db\n\"DELETE FROM metadata_item_settings\nWHERE id in (SELECT MIN(id) \nFROM metadata_item_settings \nGROUP BY guid HAVING COUNT(guid) &gt; 1);\"\n</code></pre>","tags":["database","plex"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid - Apcupsd Container Edition","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-apcupsd-container-edition","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid - Apcupsd Container Edition","text":"<p>Written: 2019-07-25</p> <p>Tags</p> <p> docker </p> <p> grafana </p> <p> influxdb </p> <p> kwh </p> <p> monitoring </p> <p> power </p> <p> ups </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p></p> <p>I recently discovered the atribe/apcupsd-influxdb-exporter container on the CA plugin page and immediately thought it would be a great replacement for the script that I run, described in this post. But time got in the way and I forgot about it. But now the summer is here, the days are longer and free time is no longer a rarity :) So this will be a quick follow up post on how to switch to this container and get even more accurate readings!</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#grafana","title":"Grafana","text":"<p>If you haven't installed or used Grafana and InfluxDB, I recommend reading this post first. You can skip the Telegraf part but that's no fun :)</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#influxdb","title":"InfluxDB","text":"<p>Dont' use the latest tag</p> <p>The <code>:latest</code> tag will run InfluxDB V2! This guide was written for v1.8. Change the tag to <code>:1.8.x</code> for it to work!</p> <p></p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#installing-the-container","title":"Installing the container","text":"<p>Note</p> <p>You need to activate the apcupsd daemon to be able to show any statistics. Go to Settings -&gt; UPS Settings and set Start APC UPS daemon: to Yes. Then Click <code>Apply</code></p> <p>Search for <code>apcupsd</code> in CA and click install. Fill out the different container variables to match your setup. Remember to click on <code>Show more settings...</code> to see the rest of the variables. </p> <p>Warning</p> <p>If your UPS has the NOMPOWER metric you need to remove this variable as it may interfere with how it reports the watts usage</p> <p>You can see if it reports it by going to the dashboard and look at the stats or run the <code>apcaccess</code> command. <code>apcaccess | grep NOMPOWER</code></p> <p></p> <p></p> <p>The <code>INFLUXDB_HOST</code> and <code>APCUPSD_HOST</code> will most likely be your Unraid IP and <code>INFLUXDB_PORT</code> is the port for your InfluxDB http service. Default it will be <code>8086</code>. You can leave user and password blank if you don't have a specific user you want to use in your InfluxDB instance. The database will be created at the launch of the apcupsd container, so you don't need to create it manually. If you're using the php script from my previous post I recommend using a different database as the intervals are not the same and the queries in the first dashboard wont work.</p> <p>If you want to change the interval you can add the <code>INTERVAL</code> variable set your desired value. Default is 10(seconds)</p> <p>Note</p> <p>If you change the interval you need to update the queries on the dashboard to reflect the change. The default is 360 values per hour (6 intervals per minute * 60 minutes)</p> <p></p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#ups-dashboard","title":"UPS Dashboard","text":"<p>After you have installed the apcupsd container add the datasource in Grafana and use the database name you chose above.</p> <p></p> <p>Next import my new UPS dashboard and select the correct datasource in the drop down menu at the top. Link to dashboard: https://grafana.com/grafana/dashboards/10615</p> <p></p> <p>And that's it! Enjoy your new and improved UPS stats!</p> <p></p> <p>The custom theme for Grafana can be found here: https://github.com/gilbN/theme.park</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server!","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-2019-edition/#_1","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid - Apcupsd Container Edition","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 NUT Edition","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 NUT Edition","text":"<p>Written: 2019-09-25</p> <p>Tags</p> <p> docker </p> <p> grafana </p> <p> influxdb </p> <p> kwh </p> <p> monitoring </p> <p> power </p> <p> unraid </p> <p> ups </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p></p> <p>This quick guide will explain how to setup Grafana and InfluxDB to monitor your UPS power usage using the NUT plugin and maihai/nut-influxdb-exporter docker container on Unraid. This pretty much just a rewrite of this article but for the NUT plugin.</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#grafana","title":"Grafana","text":"<p>If you haven't installed or used Grafana and InfluxDB, I recommend reading this post first. You can skip the Telegraf part but that's no fun :)</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#influxdb","title":"InfluxDB","text":"<p>Dont' use the latest tag</p> <p>The <code>:latest</code> tag will run InfluxDB V2! This guide was written for v1.8. Change the tag to <code>:1.8.x</code> for it to work!</p> <p></p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#installing-the-container","title":"Installing the container","text":"<p>Search for <code>nut influx exporter</code>in CA and click install. Fill out the different container variables to match your setup. Remember to click on <code>Show more settings...</code> to see the rest of the variables. If your UPS reports the <code>WATTS/Nominal Power</code>metric you can remove this variable. You can see if it reports it by going to the dashboard and look at the stats or run the <code>upsc ups</code> command.</p> <p></p> <p></p> <p>The <code>INFLUXDB_HOST</code> and <code>NUT_HOST</code> will most likely be your Unraid IP and <code>INFLUXDB_PORT</code> is the port for your InfluxDB http service. Default it will be <code>8086</code>. You can leave user and password blank if you don't have a specific user you want to use in your InfluxDB instance. And the same for the NUT port, username and password.</p> <p>The database will be created at the launch of the container, so you don't need to create it manually.</p> <p>The default interval is set to 20 seconds, and if I recall correctly that is the max for NUT. I tried setting it to 10 seconds using the INTERVAL variable but when I did that it reported the same metric twice all the time.</p> <p></p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#ups-dashboard","title":"UPS Dashboard","text":"<p>After you have installed the apcupsd container add the datasource in Grafana and use the database name you chose above.</p> <p></p> <p>Next import my new UPS dashboard and select the correct datasource in the drop down menu at the top. Link to dashboard: https://grafana.com/grafana/dashboards/10914</p> <p></p> <p>And that's it! Enjoy your new and improved UPS stats!</p> <p></p> <p>The custom theme for Grafana can be found here: https://github.com/gilbN/theme.park</p>","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-nut-edition/#_1","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 NUT Edition","text":"","tags":["docker","grafana","influxdb","kwh","monitoring","power","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 Telegraf Edition","text":"","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 Telegraf Edition","text":"<p>Written: 2019-10-08</p> <p>Tags</p> <p> cost </p> <p> database </p> <p> docker </p> <p> grafana </p> <p> influxdb </p> <p> kwh </p> <p> monitoring </p> <p> telegraf </p> <p> unraid </p> <p> ups </p> <p>Category</p> <p> backend </p> <p> frontend </p> <p></p> <p>So.. I just found out that Telegraf recently added Apcupsd as a plugin. So naturally I created a dashboard for it :) I promise, this is the last UPS stats blog post for a while!</p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#installing-influxdb","title":"Installing InfluxDB","text":"<p>Just skip down to the plugin part if you're already up and running.</p> <p>Search for <code>influxdb</code> in Community Apps and install it using the default template. Select your appdata path and host ports if the default ones are taken. There is no other setup than just installing the container.</p> <p>Note</p> <p>Dont' use the latest tag\" icon=\"fa-exclamation-triangle\" type=\"warn\" message=\"The <code>:latest</code> tag will run InfluxDB V2! This guide was written for v1.8. Change the tag to <code>:1.8.x</code> for it to work!</p> <p></p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#installing-telegraf","title":"Installing Telegraf","text":"<p>Again, you can just skip this step if telegraf is already setup :)</p> <p>Warning</p> <p>This container wont start unless the telegraf.conf file already exists on the host. (Host path 7) Do not install the container before you follow the steps below!</p> <ol> <li> <p>Download the file and place it in the location you want the telegraf appdata to be. e.g. <code>/mnt/cache/appdata/telegraf/telegraf.conf</code> The default config file can be downloaded here: https://github.com/influxdata/telegraf/blob/master/etc/telegraf.conf</p> </li> <li> <p>Next you need to edit the <code>telegraf.conf</code> file. Go to the location you saved the file and scroll down to <code>OUTPUT PLUGINS</code> which should be around line 90-103.Uncomment (Remove #) the http url line for InfluxDB like so:</p> </li> </ol> <pre><code>  # urls = [\"unix:///var/run/influxdb.sock\"]\n# urls = [\"udp://127.0.0.1:8089\"]\nurls = [\"http://192.168.1.34:8086\"]\n</code></pre> <p>192.168.1.34 is the IP address to my Unraid server and 8086 is the default InfluxDB port that runs the InfluxDB HTTP service.</p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#adding-the-plugin","title":"Adding the plugin","text":"<p>If you already have telegraf installed you can simply add or uncomment the plugin line <code>[[inputs.apcupsd]]</code> like so:</p> <pre><code># # Monitor APC UPSes connected to apcupsd\n[[inputs.apcupsd]]\n#   # A list of running apcupsd server to connect to.\n#   # If not provided will default to tcp://127.0.0.1:3551\n#   servers = [\"tcp://127.0.0.1:3551\"]\n#\n#   ## Timeout for dialing server.\n#   timeout = \"5s\"\n</code></pre> <p>If the config file is up to date the it should be around line 1783. If it's not just add it to the config file.</p> <p>If you want to add more plugins check out this post:How to setup Grafana, InfluxDB and Telegraf to monitor your unRAID system.</p> <p>Note</p> <p>You need to activate the apcupsd daemon to be able to show any statistics. Go to Settings -&gt; UPS Settings and setStart APC UPS daemon: to Yes. Then Click <code>Apply</code></p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#installing-grafana","title":"Installing Grafana","text":"<p>Installing Grafana is also quite simple. Chose your host port for the webUI and add your unraid URL and admin password to the container settings.</p> <p></p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#configuring-grafana","title":"Configuring Grafana","text":"<p>After the installation is finished go to the WebUI. <code>http://unraidIP:3000</code> and log in with username <code>admin</code> and the password you chose. You should then see this on you screen:</p> <p>Click on <code>Add data source</code> and select InfluxDB.</p> <p></p> <p></p> <p>Next give the data source a name, add the URL to InfluxDB, enter the database to use (telegraf) and click Save &amp; Test</p> <p></p> <p>If all your settings are correct you should see this message.</p> <p></p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#adding-the-dashboard","title":"Adding the dashboard","text":"<p>Next import the dashboard by hovering over the + icon and selecting Import</p> <p></p> <p>Paste the dashboard ID 10977 and click Load</p> <p>Give it a name and UID, and click Import.</p> <p></p> <p>Next add your kWh price, max watt and select the Telegraf datasource.</p> <p></p> <p>You should now see the panels starting to populate!</p> <p>The custom theme for Grafana can be found here: https://github.com/gilbN/theme.park</p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/monitoring-your-ups-stats-and-cost-with-influxdb-and-grafana-on-unraid-telegraf-edition/#_1","title":"Monitoring your UPS stats and cost with InfluxDB and Grafana on Unraid \u2013 Telegraf Edition","text":"<p>Sources:</p> <p>https://github.com/influxdata/telegraf/tree/master/plugins/inputs/apcupsd https://github.com/influxdata/telegraf/blob/master/etc/telegraf.conf</p>","tags":["cost","database","docker","grafana","influxdb","kwh","monitoring","telegraf","unraid","ups"]},{"location":"blog/my-unraid-server/","title":"My unRAID Server","text":"","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#my-unraid-server","title":"My unRAID Server","text":"<p>Written: 2017-07-18</p> <p>Tags</p> <p> docker </p> <p> plex </p> <p> server </p> <p> unraid </p> <p>Category</p> <p> blog </p> <p></p> <p>Since this blog will mostly be for my own sake. Just me writing down some guides on different things so I don't forget. I think it's appropriate that my first post will be about my server..</p> <p></p> <p></p> <p>My current server exists mainly for serving myself and my familiy/friends plex content. Now since this is it's main purpose it is somewhat over powered.</p>","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#specs","title":"Specs:","text":"<ul> <li>CPU: 2 x XEON E5-2670v1- [16 cores / 32 threads @ 2.60 GHz/3.30 GHz ]</li> <li>CPU cooler: 2 x Noctua NH-U14S</li> <li>Motherboard: Supermicro X9DRL-iF</li> <li>RAM: Samsung ECC REG 64GB 8x8GB 1333mhz [M393B1K70DH0-YH9]</li> <li>PSU: Corsair RM850x 850W</li> <li> <p>Case: Fractal Define R5</p> </li> <li> <p>HDD's:</p> </li> <li>1 x Seagate Ironwolf 8TB [Parity drive]</li> <li>2 x Seagate Ironwolf 4TB[Data drives]</li> <li>4 x WD Red 4TB NAS Harddrive[Data drives]</li> <li>2 x Crucial MX300 275GB SSD[Cache drives in RAID1]</li> <li>1 x HyperX Fury 120GB 2.5\" SSD[Plex drive]</li> <li>OS drive: Kingston Datatraveler SE9 16GB USB drive</li> </ul> <p>Now up until Feb 2017 my server was my old i5-3570K gaming rig and a low power freenas setup, and because I wanted to lower the overall power usage so I bought all the equipment above to do exactly that.. Makes sense right? Not exactly.. \u00af(\u30c4)/\u00af</p> <p>Well.. after hanging out in the Plex Discord channel, things got a little overboard. Now, my server is not nearly as powerful as some people over at r/plex or r/homelab but with a 18K passmark score it can easily transcode up to 14 1080P streams on plex. Not that it will ever have to..</p> <p> The server on my \"test bench\" with my old NAS, and yes I'm an Alien fan :)</p>","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#os","title":"OS:","text":"<p>Should be no surprise, but if you haven't figured it out yet, I run all this on LimeTech's unRAID OS 6 And coming from windows it has mostly been an easy ride.</p> <p>Now why unRAID?</p> <p>Simply put; Docker.. Now there's more to unRAID than docker containers. A lot more. But I wanted an \"all in one package\" that I could easily manage and expand. And unRAID does just that. Before unRAID I was running my NAS on Freenas 9.10 Freenas is an awesome free storage OS that is great for both home and business use as it uses the ZFS filesystem. I won't go into detail what ZFS is why it's great, but my biggest gripe with Freenas was that the app support wasn't the greatest. For just a storage OS it worked great.</p> <p>The main page on the unRAID GUI </p>","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#use","title":"Use","text":"<p>As I have stated, the main purpose of my server is to serve content via plex. But adding a couple of drives, install Plex and call it a day is way too boring. Especially when there are so many good tools and services that integrate with Plex. And the ease of using all of them alongside unRAID is definitively a bonus.</p> <p>Tools I run on my server to make my Plexperiance better:</p> <p>Organizr Tautulli Sonarr Radarr Ombi Letsencrypt container Jackett Deluge Netdata Sub-Zero UptimeRobot Lidarr SabNZBd Grafana InfluxDB Telegraf Varken ApacheGuacamole</p> <p>The dashboard that shows all your running containers / VM's </p> <p>Most of these are Docker Containers from the guys over at linuxserver.io. Except Sub-Zero that is a Plex plugin and Uptimerobot that is an external downtime service.</p> <p>My latest obsession has been getting Organizr to work with Letsencrypt/nginx and implementing all my services into that. For someone who didn't know what a web server even was a month ago, it has been quite a steep learning curve..</p> <p>But that's what it's all about.</p> <p>My next post will be about setting up the letsencrypt docker and all the other services I run on you own domain. Stay tuned.</p>","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here:","text":"","tags":["docker","plex","server","unraid"]},{"location":"blog/my-unraid-server/#_1","title":"My unRAID Server","text":"","tags":["docker","plex","server","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/","title":"Optimizing PHP-FPM to get faster load times of tabs in Organizr","text":"","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr","title":"Optimizing PHP-FPM to get faster load times of tabs in Organizr","text":"<p>Written: 2018-07-15</p> <p>Tags</p> <p> organizr </p> <p> php </p> <p> php-fpm </p> <p> unraid </p> <p>Category</p> <p> backend </p> <p></p> <p>For me this all started when I was setting up Logarr and opened the Organizr(v1) container php error log <code>/log/php/error.log</code> and saw that this error was repeating on an hourly basis:</p> <p><code>WARNING: [pool www] server reached pm.max_children setting (5), consider raising it[_timestamp_]</code></p> <p>This means that there are not enough PHP-FPM processes. In Organizr v2 I did not get this error in the php error log, but optimizing the child processes still got me faster load times of tabs in Organizr.</p> <p>Note that for this guide, it does not matter if you use Organizr V1 or V2.</p> <p>We need write-access to <code>/etc/php7/php-fpm.d/www.conf</code> in order to optimize the following settings:</p> <p><code>pm pm.max_children pm.start_servers pm.min_spare_servers pm.max_spare_servers pm.max_requests</code></p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#copying-the-wwwconf-file-to-configphp","title":"Copying the www.conf file to /config/php","text":"<p>We need to perform this step because the file must 'exist' before it can be mapped.</p> <p>First docker exec into your Organizr docker container. Assuming you are using a fairly new version of UnRaid, click your Organizr container icon and then click \"Console\".</p> <p></p> <p>If not run <code>docker exec -it [contrainername] bash</code> in the console</p> <p>In the console window, run the command: <code>cp /etc/php7/php-fpm.d/www.conf /config/php</code> A copy of www.conf is now present in Organizr's php-folder.</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#linking-the-newly-copied-wwwconf-file-to-the-original","title":"Linking the newly copied www.conf file to the original","text":"<p>Create the following new path for your Organizr docker container in UnRaid:</p> <pre><code>* Config Type: Path\n* Name: phpchildren\n* Container Path: /etc/php7/php-fpm.d/www.conf\n* Host Path: /mnt/cache/appdata/organizr-v2/php/www.conf\n* Access Mode: Read/Write\n* Description: Container Path: /etc/php7/php-fpm.d/www.conf\n</code></pre> <p>The same is shown here:</p> <p></p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#calculate-and-change-settings-in-wwwconf","title":"Calculate and change settings in www.conf","text":"<p>Open the www.conf file with notepad++ or similar to edit the following values:</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pm","title":"pm","text":"<p><code>**pm = dynamic**</code> means that the number of servers specified in <code>pm.start_servers</code> will always be running in the PHP-FPM process, and more will be created if needed. <code>pm = ondemand</code> means that <code>**pm.start_servers**</code> is ignored and servers will be created if they are needed.</p> <p>Personally, I have decided to use the default**<code>pm = dynamic</code>** because I have very much RAM compared how loaded my webserver is. If I always needed resources to be freed up, I would have chosen the ondemand setting.</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pmmax_children","title":"pm.max_children","text":"<p>Open the terminal in UnRaid. Run the command <code>ps -ylC php-fpm --sort:rss</code> You will likely get a bunch of php-fpm processes like I do:</p> <p></p> <p>The RSS column shows non-swapped physical memory usage by PHP-FPM processes in kilobytes.</p> <p>An appropriate value for pm.max_children can be calculated as: <code>pm.max_children =</code> Total RAM dedicated to the web server / Max child process size</p> <p>The max child process size for me is 19MB and my server-rig has 32GB of RAM. I decide that I want to use a maximum of, say, 20GB on PHP-FPM processes. Evaluating the formula with these values yields pm.max_children = 20000 / 19 = 1053 ~ 1000. Thus, Iset <code>pm.max_children = 1000</code>. This is ridiculously high. But I have the RAM for it. For reference, in myshell's guide linked below, he concludes an appropriate pm.max_children = 72 with 8 GB ram installed, so the less RAM and more load you have on your server, the more important this calculation and setting becomes.</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pmmin_spare_servers","title":"pm.min_spare_servers","text":"<p>Set <code>pm.min_spare_servers = 1</code></p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pmmax_spare_servers","title":"pm.max_spare_servers","text":"<p>An appropriate value for pm.max_spare_servers can be calculated as: pm.max_spare_servers = 2 x number of cores OR 4 x number of cores</p> <p>Personally I have 8 cores in my AMD Ryzen 1700 processor and start with using the 2x method. Evaluating the formula with these values yields pm.max_spare_servers = 2 x 8 = 16. Thus I set <code>pm.max_spare_servers = 16</code>.But I could also try with <code>pm.max_spare_servers = 32</code> and see if I get better performance with that.</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pmstart_servers","title":"pm.start_servers","text":"<p>An appropriate value for pm.start_servers can be calculated as: pm.start_servers = pm.max_spare_servers / 2 Evaluating this gives pm.start_servers = 16 / 2 = 8. Thus I set <code>pm.start_servers = 8</code>.</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#pmmax_requests","title":"pm.max_requests","text":"<p>Set <code>pm.max_requests = 500</code></p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#concluding-remarks","title":"Concluding remarks","text":"<p>Restart your Organizr docker container and enjoy an even faster Organizr experience. Of course YMMV, tweak the settings above to further optimize, as they depend very much on your server hardware, the PHP-FPM processes you are hosting, and the load on your webserver, i.e. the number of simultaneous users.</p> <p>Sources: https://myshell.co.uk/blog/2012/07/adjusting-child-processes-for-php-fpm-nginx/ https://ma.ttias.be/a-better-way-to-run-php-fpm/ https://stackoverflow.com/questions/25097179/warning-pool-www-seems-busy-you-may-need-to-increase-pm-start-servers-or-pm</p>","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/optimizing-php-fpm-to-get-faster-load-times-of-tabs-in-organizr/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here","text":"","tags":["organizr","php","php-fpm","unraid"]},{"location":"blog/redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page/","title":"Redirecting visitors to a 403 forbidden page when accessing the Wordpress admin page","text":"","tags":["access","cloudflare","customization","security","wordpress"]},{"location":"blog/redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page/#redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page","title":"Redirecting visitors to a 403 forbidden page when accessing the Wordpress admin page","text":"<p>Written: 2019-08-16</p> <p>Tags</p> <p> access </p> <p> cloudflare </p> <p> customization </p> <p> security </p> <p> wordpress </p> <p>Category</p> <p> frontend </p> <p> security </p> <p></p> <p>So after my last post I woke up to around 40+ and counting notifications on IP's that fail2ban had banned over the night. They were all failed attempts to get past the basic auth prompt I have on my Wordpress admin page. So with the last post fresh in my mind I knew it was possible to have a Cloudflare worker load a different page for visitors based on their IP.</p> <p>This was my fail2ban channel on discord. If you want these kind of notifications check out my fail2ban post!</p> <p></p> <p>So using the same resource as in the first Cloudflare worker post we can easily route visitors to a custom 403 Forbidden page. Now they can't even try to get passed the basic auth! Have a look here: https://technicalramblings.com/wp-admin</p> <p>Note</p> <p>If you have a dynamic ip that often changes, this might not be the best solution for you!</p>","tags":["access","cloudflare","customization","security","wordpress"]},{"location":"blog/redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page/#creating-a-worker","title":"Creating a worker","text":"<p>On your Cloudflare dashboard click on Workers and go through the first time setup if you haven't done that yet. Next click on <code>Manage Workers</code> and <code>Create a Worker</code></p> <p></p> <p>Paste the script below.</p> <pre><code>addEventListener(\"fetch\", event =&gt; {\nevent.respondWith(fetchAndReplace(event.request));\n});\n\nasync function fetchAndReplace(request) {\nlet modifiedHeaders = new Headers();\n\nmodifiedHeaders.set('Content-Type', 'text/html');\nmodifiedHeaders.append('Pragma', 'no-cache');\n\n//Return 403 page if you're not calling from a trusted IP\nconst white_list = [\n'1.1.1.1',\n'2.2.2.2'\n];\nif (white_list.indexOf(request.headers.get(\"cf-connecting-ip\")) &gt; -1)\n//Fire all other requests directly to your WebServer\nreturn fetch(request);\n\nelse {\n// Return modified response.\nreturn new Response(forbiddenPage, {\nheaders: modifiedHeaders\n});\n}\n}\n\nlet forbiddenPage = `\n\n&lt;!DOCTYPE html&gt;\n&lt;title&gt;nope...&lt;/title&gt;\n&lt;style&gt;\n@import url('https://fonts.googleapis.com/css?family=Press+Start+2P');\n\nhtml,body{\n   width: 100%;\n   height: 100%;\n   margin: 0;\n}\n\n*{\n   font-family: 'Press Start 2P', cursive;\n   box-sizing: border-box;\n}\n#app{\n   padding: 1rem;\n   background: black;\n   display: flex;\n   height: 100%;\n   justify-content: center; \n   align-items: center;\n   color: #54FE55;\n   text-shadow: 0px 0px 10px ;\n   font-size: 6rem;\n   flex-direction: column;\n   .txt {\n      font-size: 1.8rem;\n   }\n}\n@keyframes blink {\n    0%   {opacity: 0}\n    49%  {opacity: 0}\n    50%  {opacity: 1}\n    100% {opacity: 1}\n}\n\n.blink {\n   animation-name: blink;\n    animation-duration: 1s;\n   animation-iteration-count: infinite;\n}\n&lt;/style&gt;\n&lt;body&gt;\n&lt;div id=\"app\"&gt;\n   &lt;div&gt;403&lt;/div&gt;\n   &lt;div class=\"txt\"&gt;\n      Forbidden&lt;span class=\"blink\"&gt;_&lt;/span&gt;\n   &lt;/div&gt;\n&lt;/div&gt;\n&lt;/body&gt;\n\n`;\n</code></pre> <p>Add your whitelisted IP's in this section:</p> <pre><code>//Return 403 page if you're not calling from a trusted IP\nconst white_list = [\n'1.2.3.4',\n'5.6.7.8'\n];\n</code></pre> <p>Save and deploy the worker.</p> <p>Go back to the main worker page and add your routes. The two routes I use are <code>domain.com/wp-login*</code> and <code>domain.com/wp-admin*</code></p> <p></p> <p>The page should now look like this when accessing from another IP than the white listed ones.</p> <p></p> <p>Neat right!</p> <p>If you want a different page showing it's as simple as replacing the html. I just googled <code>403 forbidden template</code> and found the one above on codepen.</p>","tags":["access","cloudflare","customization","security","wordpress"]},{"location":"blog/redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["access","cloudflare","customization","security","wordpress"]},{"location":"blog/redirecting-visitors-to-a-403-forbidden-page-when-accessing-the-wordpress-admin-page/#_1","title":"Redirecting visitors to a 403 forbidden page when accessing the Wordpress admin page","text":"<p>Source:</p> <p>https://codepen.io/lsgrrd/pen/BObbYY https://www.resdevops.com/2018/03/20/cloudflare-workers-maintenance-mode-static-page/</p>","tags":["access","cloudflare","customization","security","wordpress"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/","title":"Remotely accessing the Unraid GUI with Guacamole and VNC Web Browser","text":"","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser","title":"Remotely accessing the Unraid GUI with Guacamole and VNC Web Browser","text":"<p>Written: 2018-06-12</p> <p>Tags</p> <p> apache </p> <p> fail2ban </p> <p> geoblocking </p> <p> guacamole </p> <p> letsencrypt </p> <p> nginx </p> <p> organizr </p> <p> security </p> <p> vnc </p> <p>Category</p> <p> administration </p> <p> backend </p> <p></p> <p>So.. you've finished installing and setting up all your docker containers, plugins ect. Radarr is doing its thing, Plex is chugging away... everything is just peachy! And now you want to be able to access the unraid GUI outside your network.</p> <p>The safest method you can do this is by setting up a VPN. You can do that by installing the OpenVPN container but that won't give you access if your server or the docker service crashes. So setting up the VPN on the router ect is much more recommended. BUT you're not always in a situation where you can connect to a VPN. For example your work computer. Be it you don't have the administrator rights to change your network settings or your company policy forbids it.. This is where Apache Guacamole is useful. By installing Apache Guacamole, centos-xfce-vncFirefox vnc and letsencrypt we can gain access to the unraid GUI externally. And by setting up fail2ban and geo-block we can protect our self from bruteforce attempts at gaining access!</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#guacamole-installation","title":"Guacamole Installation","text":"","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#apache-guacamole","title":"Apache Guacamole","text":"<p>I use the <code>jasonbean/guacamole</code> container. Nothing special you need to think about. Add your custom port and select your appdata location. The defaultusername and password is**guacadmin Note:** It isn't mentioned in the documentation but if you are installing the container using docker run or compose you need to add <code>-e 'OPT_MYSQL'='Y'</code></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#firefox-vnc-web-browser","title":"Firefox VNC Web Browser","text":"<p>Search for <code>VNC Web Browser</code> in community applications and you will find a template bycheesemarathon for the <code>consol/centos-xfce-vnc</code> container. I have found that using the VNC Web Browser Container gives me constant connection errors and have switched to the Firefox container (jlesage/firefox) instead. Install the container and add your VNC Password if you want. Take note of the VNC port as you will need that later. Use the VNC_PASSWORD variable described here Do not add SSL in the container settings as it looks like Guacamole doesn't support VNC with encryption.</p> <p></p> <p></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#lets-encrypt","title":"Let's Encrypt","text":"<p>To access all this we'll use the <code>linuxserver/swag</code> container from linuxserver. _This container sets up an Nginx web serverand reverse proxy with php support and a built-in letsencrypt client that automates free SSL server certificate generation and renewal processes. It also contains fail2ban for intrusion prevention.</p> <p>Before we start you need to acquire a domain. You can do that onduckdnsor any other domain service.</p> <p>I\u2019m usinghttps://domains.google/and I\u2019m very happy with that.</p> <p>If you have a dynamic ip-address you can setup thecaptinsano DDclientcontainer and have that update yoursynthetic record. If you don't want to pay for a custom domain, using the duckdns container will work just fine.</p> <p>Forward your domain to your public IP address. After you've done that add your different ANAME/CNAME records e.g guacamole.yourdomain.com or unraid.yourdomain.com</p> <p></p> <pre><code>@ = root domain (technicalramblings.com) and points to my external ip\nwww = sub domain grafana = sub domain\nTTL: (Time to Live) How often a copy of the record stored in cache must be updated or discarded.\n</code></pre>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#swag-installation","title":"SWAG Installation","text":"<ol> <li>Container Port: 80- Choose your desired host port. e.g**81** (You can't set this to 80 as the unRAID web GUI uses that. )</li> <li>Container Port: 443-Set this to 444 or something else (On update 6.4 unraid will use port 443 if you setup https and it\u2019s better to be ahead of time so it won\u2019t cause any issues)</li> <li>Enter you email</li> <li>Add your domain e.g yourdomain.com</li> <li>Add your different sub domains e.g <code>**guacamole,guac**</code> ect</li> <li>Validation: Select your validation type. <code>http</code> will work in most cases (Unless your ISP blocks port 80)</li> <li>_Container Path: /config_Install the container config to your desired location. I recommend using an SSD.</li> </ol> <p>Next is port forwarding. This is done on your router and you need to forward port 80 and 443 to the ports you chose in step 1 and 2. So if your servers IP is 192.168.1.2 and you have chosen that the container is on port 81, you need to forward all traffic on port 80 to port 81 on IP 192.168.1.2 And do the same for port 443 to 444. If you're unsure how to do this on your router check out: Portforward.com</p> <p></p> <p>Next go to https://yourserverip:444 or http://yourserverip:81 If you now see the Nginx welcome page, it works. Also test if yourdomain.com redirects you to the nginx welcome page.</p> <p>Note: TTL differs from each provider, some has a minimum 60 minutes before DNS propagates and others have 1 minute. So it might take a while before https://yourdomain.com works.</p> <p></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#configuring-apache-guacamole","title":"Configuring Apache Guacamole","text":"<p>Browse to the Apache guacamole container and login.You can add a new admin user if you want. The default username and password is <code>guacadmin</code></p> <p></p> <p>Go to Settings and click on Connections Click on New Connection Give the connection a name. I just called it Firefox. And Location is <code>ROOT</code> and Protocol is <code>VNC</code> Set your Maximum number of connections, I use 3</p> <p></p> <p>Scroll down to Parameters - Network. Add your Hostname: Your Unraid IP Add your Port: This is the VNC port to the<code>**Firefox**</code> container (default is 7914) For Authentication input the password you set for the<code>**Firefox**</code>container. Click Save</p> <p></p> <p>You can now test the connection you have created. Click on your user name and select the connection. You should now be presented with the desktop of the VNC Web Browser container.</p> <p></p> <p></p> <p>Tip: If you want to go back to settings just press <code>ctrl + shift + alt</code> to open the side menu. Here you can also copy text that you have copied within the VNC connection!</p> <p>Here you can open Firefox and go to your unraid IP and log in.</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#windows-10-vm-with-rdp","title":"Windows 10 VM with RDP","text":"<p>You can also easily add your Windows VM using RDP, this will also let you mount your shares so you can manage your files like you would at home.  This is how I added my Windows 10 Pro VM:</p> <p></p> <p>The 3389 port is the RDP port.</p> <p></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#configuring-nginx","title":"Configuring Nginx","text":"<p>Go to your letsencrypt appdata location.</p> <p>Find the <code>nginx</code> folder and then edit the file called <code>default</code> or add a new <code>**.conf**</code> file in the <code>site-conf</code> folder.</p> <p>I recommend usingnotepad++</p> <p>If you want to use this on a subdomain I recommend creating a <code>**guacamole.conf**</code> file instead and adding the nginx config to that.</p> <p>Below is an nginx config that will giveyou A+ ratings onsecurityheaders.io and ssllabs.com</p> <p></p> <p><code>**server_name guacamole.domain.com;**</code>This is where you will add your domain name e.g <code>guacamole.duckdns.org</code> <code>proxy_pass http://192.168.1.34:8089/;</code>**This is your IP and port to the**Apache Guacamole container</p> <p>READ THE COMMENT ON add_header X-Frame-Options AND add_header Content-Security-Policy IF YOU USE THIS ON A SUBDOMAIN YOU WANT TO IFRAME!</p> <pre><code># GUACAMOLE CONTAINER\nserver {\nlisten 80;\nserver_name guacamole.domain.com;\nreturn 301 https://$server_name$request_uri;\n}\n\nserver {\nlisten 443 ssl http2;\nserver_name guacamole.domain.com;\n\n##SSL SETTINGS\n## READ THE COMMENT ON add_header X-Frame-Options AND add_header Content-Security-Policy IF YOU USE THIS ON A SUBDOMAIN YOU WANT TO IFRAME!\n\n## Certificates from LE container placement\nssl_certificate /config/keys/letsencrypt/fullchain.pem;\nssl_certificate_key /config/keys/letsencrypt/privkey.pem;\n\n## Strong Security recommended settings per cipherli.st\nssl_dhparam /config/nginx/dhparams.pem; # Bit value: 4096\nssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;\nssl_ecdh_curve secp384r1; # Requires nginx &gt;= 1.1.0\nssl_session_timeout  10m;\n\n## NOTE: The add_header Content-Security-Policy won't work with duckdns since you don't own the root domain. Just buy a domain. It's cheap\n## Settings to add strong security profile (A+ on securityheaders.io/ssllabs.com)\n\nadd_header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\";\nadd_header X-Content-Type-Options nosniff;\nadd_header X-XSS-Protection \"1; mode=block\";\nadd_header X-Robots-Tag none; #SET THIS TO index IF YOU WANT GOOGLE TO INDEX YOU SITE!\nadd_header Content-Security-Policy \"frame-ancestors https://*.DOMAIN.COM https://DOMAIN.COM https://$server_name\"; #Add your domains you want to enable iframing on\nadd_header X-Frame-Options \"allow-from https://DOMAIN.COM https://$server_name\"; #Add your domains you want to enable iframing on. https://$server_name = sub.domain.com in this server block\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\";\n\nadd_header Feature-Policy \"geolocation none;midi none;notifications none;push none;sync-xhr none;microphone none;camera none;magnetometer none;gyroscope none;speaker self;vibrate none;fullscreen self;payment none;\";\n#FEATURE POLICY: READ MORE HERE: https://scotthelme.co.uk/a-new-security-header-feature-policy/\n\nproxy_cookie_path / \"/; HTTPOnly; Secure\"; ##NOTE: This may cause issues with unifi. Remove HTTPOnly; or create another ssl config for unifi.\nmore_set_headers \"Server: Classified\";\nmore_clear_headers 'X-Powered-By';\n##END SSL SETTINGS\n\nlocation / {\nproxy_pass http://192.168.1.34:8089/;\nproxy_buffering off;\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection $http_connection;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_http_version 1.1;\nproxy_no_cache $cookie_session;\n\n}\n}\n</code></pre> <p></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#configuring-fail2ban","title":"Configuring fail2ban","text":"<p>From github: Fail2Ban scans log files like<code>**/var/log/auth.log**</code>and bans IP addresses conducting too many failed login attempts. It does this by updating system firewall rules to reject new connections from those IP addresses, for a configurable amount of time. Fail2Ban comes out-of-the-box ready to read many standard log files, such as those for sshd and Apache, and is easily configured to read any log file of your choosing, for any error you wish.</p> <p>Luckily Fail2ban comes preinstalled with your letsencrypt container, so you only need to add the filter and edit the <code>jail.local</code> file!</p> <p>For this to work we need the letsencrypt container to be able to see the <code>catalina.out</code>**file in the **Apache Guacamole container.</p> <ul> <li>Open the letsencrypt container settings.</li> <li> <p>Add a path from the letsencrypt container to the Apache Guacamole container.</p> </li> <li> <ul> <li>Name: guacamole fail2ban</li> <li>Container path: /guacamole or whatever you prefer</li> <li>Host path: Your path to the**Apache Guacamole <code>/log</code>** folder e.g <code>**/AppData/ApacheGuacamole/log/tomcat8**</code></li> <li>Access mode: Read only</li> <li>Description: fail2ban path intoguacamole /log folder</li> </ul> </li> </ul> <p></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#jaillocal","title":"jail.local","text":"<p>Go to thefail2ban folder inside the letsencrypt appdata folder and edit the <code>jail.local</code> file. For my config I have set the bantime to 86400 seconds (24h) The findtime is 600 seconds and maxretry is 3 At the end of the jail.local file add the following:</p> <pre><code>[guacamole-auth]\n\nenabled = true\nport = http,https\nfilter = guacamole-auth\nlogpath = /guacamole/catalina.out\nignoreip = 192.168.1.0/24\n</code></pre> <ul> <li> <p>The ignore IP is so that fail2ban won\u2019t ban your local IP. Check outhttps://www.aelius.com/njh/subnet_sheet.htmlif you are wondering what your CIDRnotation is. Most often it will be /24 (netmask 255.255.255.0) To find your netmask run <code>ipconfig /all</code> on windows or <code>ifconfig | grep netmask</code> on linux.</p> </li> <li> <p>The logpath is the container path you created in step 2. And <code>catalina.out</code> the Guacamole log.</p> </li> </ul> <p>Now, there is already a filter(guacamole.conf) for Guacamole in the <code>filter.d</code> folder inside the fail2ban folder. But that filter won't work unless we make a change to it. Copy the <code>guacamole.conf</code> file and rename it <code>guacamole-auth.conf</code> In the <code>guacamole-auth.conf</code> file change:</p> <pre><code>failregex = ^.*\\nWARNING: Authentication attempt from &lt;HOST&gt; for user \"[^\"]*\" failed\\.$\n</code></pre> <p>to</p> <pre><code>failregex = \\bAuthentication attempt from \\[&lt;HOST&gt;(?:,.*)?\\] for user \".*\" failed\\.\n</code></pre> <p>Restart the letsencrypt container.</p> <p>If you get the error below in the <code>fail2ban.log</code> file you can comment the 3 date pattern lines in the <code>guacamole-auth.conf</code> file.</p> <pre><code>2018-06-12 21:36:49,121 fail2ban.filter \\[351\\]: ERROR Error during seek to start time in \"/guacamole/catalina.out\"\n2018-06-12 21:36:49,121 fail2ban.filterpoll \\[351\\]: ERROR Caught unhandled exception in main cycle: TypeError('an integer is required',)\n</code></pre> <p>Comment these lines by adding # in front.</p> <pre><code>#datepattern = ^%%b %%d, %%ExY %%I:%%M:%%S %%p\n#^WARNING:()\\*\\*\n#{^LN-BEG}\n</code></pre> <p>Remember to restart the container anytime you make a change in the conf file.</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#banned","title":"Banned","text":"<p>The fail2ban.log file should output something like this:</p> <pre><code>2018-06-12 21:39:07,529 fail2ban.jail \\[350\\]: INFO Jail 'guacamole-auth' started\n2018-06-12 21:39:30,779 fail2ban.filter \\[350\\]: INFO \\[guacamole-auth\\] Ignore 192.168.1.1 by ip\n2018-06-12 21:39:44,801 fail2ban.filter \\[350\\]: INFO \\[guacamole-auth\\] Found 77.16.72.179 - 2018-06-12 21:39:44\n2018-06-12 21:39:57,420 fail2ban.filter \\[350\\]: INFO \\[guacamole-auth\\] Found 77.16.72.179 - 2018-06-12 21:39:57\n2018-06-12 21:40:00,025 fail2ban.filter \\[350\\]: INFO \\[guacamole-auth\\] Found 77.16.72.179 - 2018-06-12 21:39:59\n2018-06-12 21:40:00,196 fail2ban.actions \\[350\\]: NOTICE \\[guacamole-auth\\] Ban 77.16.72.179\n</code></pre>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#unbanning","title":"Unbanning","text":"<p>If you managed to ban yourself or a friend banned themself you can do this to unban. Bash into the container with: <code>docker exec -it letsencrypt bash</code> Enter fail2ban interactive mode: <code>fail2ban-client -i</code> Check the status of the jail: <code>status guacamole-auth</code></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#output","title":"Output","text":"<pre><code>fail2ban&gt; status guacamole-auth\nStatus for the jail: guacamole-auth\n|- Filter\n| |- Currently failed: 0\n| |- Total failed: 3\n| `- File list: /guacamole/catalina.out\n`- Actions\n|- Currently banned: 1\n|- Total banned: 1\n`- Banned IP list: 77.16.72.179\n</code></pre> <p>unban with: <code>set guacamole-auth unbanip 77.16.72.179</code> If you already know the IP you want to unban you can just type this: <code>docker exec -it letsencrypt fail2ban-client set guacamole-auth unbanip 77.16.72.179</code></p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#adding-geo-blocking","title":"Adding geo-blocking","text":"<p>Blocking countries with GeoLite2 in nginx using the swag/letsencrypt docker container</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#blocked","title":"Blocked","text":"<p>You can test if it worked with a VPN or do a performance test from a location that is blocked herehttps://www.webpagetest.org/</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#optional-organizr","title":"Optional: Organizr","text":"<p>Another security layer is using Organizr to block access to your guacamole.domain.com by having you to log into Organizr first! And you can even add a fail2ban filter on the Organizr login form!By using server authentication you will be shown a 401 Unauthorized page unless you log in first.</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#optional-basic-http-auth","title":"Optional: Basic http auth","text":"<p>Another security layer is using basic http auth. Linuxservers swag container is already be pre configured to ban failed http auths with fail2ban!</p> <p>Sources:https://github.com/fail2ban/fail2ban/issues/1574</p>","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/remotely-accessing-the-unraid-gui-with-guacamole-and-vnc-web-browser/#for-any-questions-you-can-find-me-here","title":"For any questions you can find me here","text":"","tags":["apache","fail2ban","geoblocking","guacamole","letsencrypt","nginx","organizr","security","vnc"]},{"location":"blog/spice-up-your-homepage/","title":"Spice up your homepage!","text":"","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#spice-up-your-homepage","title":"Spice up your homepage!","text":"<p>Written: 2017-10-31</p> <p>Tags</p> <p> chat </p> <p> customization </p> <p> discord </p> <p> homepage </p> <p> letsencrypt </p> <p> netdata </p> <p> nginx </p> <p> organizr </p> <p> tawk </p> <p>Category</p> <p> frontend </p> <p></p> <p>Spice up your homepage! A HowTo on custom Netdata pages, embedding Discord and adding customer support chat!</p> <p>I'm going to integrate these applications into my Organizr homepage but this will pretty much work on any site of your choosing.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#netdata","title":"Netdata","text":"<p>First I'd recommend you to check out the Netdata wiki oncustom dashboardsas it explains**alot**.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#preparation","title":"Preparation","text":"<p>Note: This guide assumes you have already reverse proxied netdata.</p> <p>Before we can start we need some files from the Netdata /web folder. And since I'm using the docker I will have to get them using cli.</p> <p>The files we need are:</p> <pre><code>dashboard.js\nbootstrap-slate-flat-3.3.7.css or bootstrap-3.3.7.css\ndashboard.slate.css or dashboard.css\n</code></pre> <p>I will be using using the slate (dark) theme for this guide.</p> <p>Note-2: I've made it so that if you don't want to mess with the js or css files, you can use my Netdata theme and subfilter that with nginx. Scroll down to the theme.park part!</p> <p>The CSS files are located in the /css folder and the JS file is in the /web folder.</p> <ol> <li>Open a terminal and exec into the docker container with this command: <code>docker exec -it Netdata bash</code> Goto this location:<code>cd usr/share/netdata/web/</code></li> <li>Copy the files to your appdata config path: (Host path 1) <code>cp dashboard.js dashboard.slate.css /etc/netdata/override</code></li> <li>Change directory with the cd command <code>cd css/</code> Copy the bootstrap.css file. <code>cp bootstrap-slate-flat-3.3.7.css /etc/netdata/override</code></li> </ol> <p>Tip: Use the <code>ls</code> command to list all files in a specific directory.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#editing-the-files","title":"Editing the files","text":"<ol> <li>Copy the files to a new subdirectory in your nginx root folder (e.g appdata/letsencrypt/www/customnetdata)</li> <li>Create a new folder called css (e.g customnetdata/css)</li> </ol> <p>Copy bootstrap-slate-flat-3.3.7.css and dashboard.slate.css to the css folder I'm using the dark theme (slate) css but using the regular works just fine. Just remember to edit the your custom html to use the white theme.</p> <ol> <li>In the dashboard.js file, scroll down to**<code>NETDATA.themes</code>**and change it so it points to the files you have added in the css folder. Add css/</li> </ol> <p>Before</p> <pre><code>slate: {\nbootstrap_css: NETDATA.serverDefault + 'css/bootstrap-slate-flat-3.3.7.css?v20161229-1',\ndashboard_css: NETDATA.serverDefault + 'dashboard.slate.css?v20170725-1',\n</code></pre> <p>After</p> <pre><code>slate: {\nbootstrap_css: 'css/bootstrap-slate-flat-3.3.7.css?v20161229-1',\ndashboard_css: 'css/dashboard.slate.css?v20170725-1',\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#using-the-themepark-theme","title":"Using the theme.park theme","text":"<p>If you don't want to edit css or js files you can instead only copy the html code at the bottom and the make the necessary modifications to that file. In the html code, scroll down to this line:</p> <pre><code>&lt;script type=\"text/javascript\" src=\"dashboard.js\"&gt;&lt;/script&gt;\n</code></pre> <p>And add your Netdata domain, like so:</p> <pre><code>&lt;script type=\"text/javascript\" src=\"https://YOUR-DOMAIN.COM/netdata/dashboard.js\"&gt;&lt;/script&gt;\n</code></pre> <p>By doing this you can instead subfilter the CSS changes using nginx and my theme repository on github! (read more at the nginx part) After that follow along the rest of the HTML instructions below.</p> <p>NOTE: If you get an error thatlib/jquery-2.2.4.min.js cant be found you can try and edit line [136] in dashboard.js that says <code>NETDATA.serverStatic = NETDATA.serverDefault;</code> to <code>NETDATA.serverStatic = \"https://yourdomain.com/netdata/\";</code></p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#creating-the-html","title":"Creating the HTML","text":"<p>Create your custom HTML. You can use the one I have added below and work off that. In this guide I have named it <code>custom.html</code></p> <p>In my example I have added a total CPU utilization dygraph and a disk I/O read-write dygraph. If you want a diffrent graph type change the <code>data-chart-library</code> See theNetdata wiki</p> <p>To make it work externally you need to add your external Netdata address in the html! (Netdata needs to be reverse proxied) If you add your local ip address you will get an error when trying to load it through HTTPS.</p> <pre><code>// Set the default netdata server.\n// on charts without a 'data-host', this one will be used.\n// the default is the server that dashboard.js is downloaded from.\n\nvar netdataServer = 'https://YOURNETDATADOMAIN.COM/';\n</code></pre> <p>e.g <code>https://yourdomain.com/netdata/</code></p> <p>Note: The trailing slash on https://domain.com/netdata/ is very important. If you dont add it you will get Strict MIME errors in your browser console, and it won't load properly.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#custom-html-for-total-cpu-utilization-and-disk-io","title":"Custom HTML for total CPU utilization and Disk I/O","text":"<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n&lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\"&gt;\n&lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;\n&lt;ul&gt;\n&lt;/ul&gt;\n&lt;div style=\"width: 100%; display: inline-block;\"&gt;\n&lt;div data-netdata=\"system.cpu\"\ndata-chart-library=\"dygraph\"\ndata-width=\"100%\"\ndata-height=\"140\"\ndata-after=\"-300\"\ndata-dt-element-name=\"time203\"\n&gt;&lt;/div&gt; \n&lt;div style=\"width: 100%; display: inline-block;\"&gt;\n&lt;div data-netdata=\"system.io\"\ndata-chart-library=\"dygraph\"\ndata-width=\"100%\"\ndata-height=\"120\"\ndata-after=\"-300\"\ndata-dt-element-name=\"time203\"\ndata-colors=\"#FF5555 #44c442\"\n&gt;&lt;/div&gt; \n&lt;/center&gt; \n&lt;/body&gt;\n\n&lt;script&gt;\n// this section has to appear before loading dashboard.js\n\n// Select a theme.\n// uncomment on of the two themes:\n\n// var netdataTheme = 'default'; // this is white\nvar netdataTheme = 'slate'; // this is dark\n\n// Set the default netdata server.\n// on charts without a 'data-host', this one will be used.\n// the default is the server that dashboard.js is downloaded from.\n\nvar netdataServer = 'https://YOURNETDATADOMAIN.COM/';\n&lt;/script&gt;\n\n&lt;!-- &lt;script type=\"text/javascript\" src=\"/dashboard.js\"&gt;&lt;/script&gt; --&gt;\n&lt;script type=\"text/javascript\" src=\"dashboard.js?v20170724-7\"&gt;&lt;/script&gt;\n\n&lt;script&gt;\n// Set options for TV operation\n// This has to be done, after dashboard.js is loaded\n\n// destroy charts not shown (lowers memory on the browser)\n// NETDATA.options.current.destroy_on_hide = false;\n\n// set this to false, to always show all dimensions\n//NETDATA.options.current.eliminate_zero_dimensions = true;\n\n// lower the pressure on this browser\nNETDATA.options.current.concurrent_refreshes = false;\n\n// if the tv browser is too slow (a pi?)\n// set this to false\n//NETDATA.options.current.parallel_refresher = true;\n\n// always update the charts, even if focus is lost\n\nNETDATA.options.current.stop_updates_when_focus_is_lost = false;\n\n// Since you may render charts from many servers and any of them may\n// become offline for some time, the charts will break.\n// This will reload the page every RELOAD_EVERY minutes\n\nvar RELOAD_EVERY = 1;\nsetTimeout(function(){\nlocation.reload();\n}, RELOAD_EVERY * 60 * 1000);\n\n&lt;/script&gt;\n\n&lt;/html&gt;\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#nginx","title":"Nginx","text":"<p>In your nginx config you can add this in your main server block to create a sub-directory.</p> <pre><code># CUSTOM NETDATA\nlocation /customnetdata {\n#auth_request /auth-user;\nroot /config/www/;\nindex custom.html;\n}\n</code></pre> <p>Below is the location block you need to use for the theme.park theme.</p> <pre><code># CUSTOM NETDATA USING THEME.PARK CSS\nlocation /customnetdata {\n#auth_request /auth-user;\nroot /config/www/;\nindex custom.html;\nproxy_set_header Accept-Encoding \"\";\nsub_filter\n'&lt;/head&gt;'\n'&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"https://gilbn.github.io/theme.park/CSS/themes/netdata/organizr-dashboard.css\"&gt;  &lt;/head&gt;';\nsub_filter_once on; }\n</code></pre> <p>By using <code>https://gilbn.github.io/theme.park/CSS/themes/netdata/organizr-dashboard.css</code> it will match any theme Organizr is using as the background is transparent.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#adding-it-to-your-organizr-homepage","title":"Adding it to your Organizr homepage","text":"<p>Adding it to your Org homepage is quite simple. Just add the code below and edit it to match your domain.</p> <p>Go to Settings \u2192 Edit Homepage \u2192 Custom HTML</p> <p>If you have added more graphs you'll need to change the height.</p> <pre><code>&lt;div style=\"overflow:hidden;height:282px;width:100%;position: relative;\"&gt; \n&lt;embed style=\"height:calc(100%);width:calc(100%)\" src='https://yourdomain.com/customnetdata/custom.html' /&gt;\n&lt;/div&gt;\n&lt;ul&gt;\n&lt;/ul&gt;\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#customizing-colors","title":"Customizing colors","text":"<ul> <li>For the blur theme, scroll down</li> </ul>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#bootstrap-slate-flat-337css","title":"bootstrap-slate-flat-3.3.7.css","text":"<p>Set the background-color to what you want. I set it to transparent so if I change my Org theme it will follow that.</p> <pre><code>body {\nfont-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\nfont-size: 14px;\nline-height: 1.42857143;\ncolor: #c8c8c8;\nbackground-color: transparent;\n}\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#dashboardslatecss","title":"dashboard.slate.css","text":"<p>Next is changing the <code>.netdata-legend-value</code> The background-color is the legend percent bacground color.</p> <pre><code>.netdata-legend-value {\n/*margin-left: 14px;*/\nposition: absolute;\nright: 10px;\nfloat: right;\ntext-align: right;\nfont-size: 11px; /* legend: dimension value size */\nfont-weight: bold;\nvertical-align: bottom;\nbackground-color: transparent;\nmargin-top: 0px;\nz-index: 10;\npadding: 0px;\npadding-left: 15px;\ncursor: pointer;\n/* -webkit-font-smoothing: none; */\n}\n</code></pre> <p><code>background-color: transparent;</code></p> <p>**<code>color: #E5A00D;</code>**I chose orange to match my Organizr theme.</p> <pre><code>.netdata-legend-resize-handler {\ndisplay: block;\nposition: absolute;\nbottom: 0px;\nright: 0px;\nheight: 15px;\nwidth: 30px;\nbackground-color: transparent;\nfont-size: 12px;\nvertical-align: middle;\nline-height: 15px;\ncursor: ns-resize;\ncolor: #E5A00D;\ntext-align: center;\noverflow: hidden;\nz-index: 20;\npadding: 0px;\nmargin: 0px;\n}\n</code></pre> <p>It's the same for the legend tool box, set it to transparent or what ever you like.</p> <p></p> <pre><code>.netdata-legend-toolbox {\ndisplay: block;\nposition: absolute;\nbottom: 0px;\nright: 30px;\nheight: 15px;\nwidth: 110px;\nbackground-color: transparent;\nfont-size: 12px;\nvertical-align: middle;\nline-height: 15px;\ncolor: #E5A00D;\ntext-align: center;\noverflow: hidden;\nz-index: 20;\npadding: 0px;\nmargin: 0px;\n}\n</code></pre> <p>Repeat the steps. Set the background to transparent or what ever you like. Set<code>color</code>to the color you want the buttons to be.</p> <p></p> <pre><code>.netdata-legend-toolbox-button {\ndisplay: inline-block;\nposition: relative;\nheight: 15px;\nwidth: 18px;\nbackground-color: transparent;\nfont-size: 12px;\nvertical-align: middle;\nline-height: 15px;\ncolor: #E5A00D;\ntext-align: center;\noverflow: hidden;\nz-index: 21;\npadding: 0px;\nmargin: 0px;\ncursor: pointer;\n}\n</code></pre> <p>To edit the text color change the html,body</p> <p>This will not change the graph text color</p> <pre><code>html,\nbody {\n/*font-family: Calibri,\"Segoe UI\",\"Helvetica Neue\",Helvetica,Arial,sans-serif;*/\nfont-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\nfont-style: normal;\nfont-variant: normal;\ncolor: #E5A00D;\n}\n</code></pre> <p>The graph text color is changed with</p> <pre><code>.dygraph-axis-label {\ncolor: #6c7075;\n}\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#customhtml","title":"custom.html","text":"<p>Changing the data chart colors is done in the custom HTML.</p> <pre><code>&lt;div data-netdata=\"unique.id\"\ndata-colors=\"#AABBCC #DDEEFF ...\"\n&gt;&lt;/div&gt;\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#dashboardjs","title":"dashboard.js","text":"<p>If you want to change the grid and axis color you can do that in the NETDATA.themes section in the dashboard.js file.</p> <pre><code>grid: '#283236',\naxis: '#283236',\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#blur-theme","title":"Blur theme","text":"<p>If you want to make your custom Netdata html match thelayer#Cake blur-themeyou can do this:</p> <p>In <code>dashboard.slate.css</code> change this:</p> <p>Change the body text color to #FFFFFF</p> <pre><code>html,\nbody {\n/*font-family: Calibri,\"Segoe UI\",\"Helvetica Neue\",Helvetica,Arial,sans-serif;*/\nfont-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\nfont-style: normal;\nfont-variant: normal;\ncolor: #FFFFFF;\n}\n</code></pre> <p>And set the other color options in the examples above to <code>(0, 0%, 100%, .45)</code></p> <p>For the grid and axis color set it to transparent in <code>dashboard.js</code></p> <pre><code>grid: 'transparent',\naxis: 'transparent',\n</code></pre> <p>In the <code>bootstrap-slate-flat-3.3.7.css</code> Set the background color of the graph body to <code>rgba(0, 0, 0, .15);</code></p> <pre><code>body {\nfont-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\nfont-size: 14px;\nline-height: 1.42857143;\ncolor: #c8c8c8;\nbackground-color: rgba(0, 0, 0, .15);\n}\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#discord-widgetbot","title":"Discord Widgetbot","text":"<p>First you'll need to create your own Discord Server. After you've done that head over tohttps://widgetbot.voakie.com/an sign in with your Discord credentials.</p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#setup","title":"Setup","text":"<ol> <li>Connect the WidgetBot with your user and choose your server in the \"Configurator\"</li> <li>Selct the channel you want to embed.</li> <li>If you want to change the colors of the widget you need to sign up to the patreon here:https://www.patreon.com/widgetbot</li> </ol>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#organizr-html-config","title":"Organizr html config","text":"<p>Add this in the homepage HTML and edit the values to your liking.</p> <pre><code>&lt;div style=\"overflow:hidden;height:300px\"&gt; \n&lt;embed style=\"height:calc(100% + 115px)\" width='100%' src='URL TO YOUR WIDGET' /&gt;\n&lt;/div&gt;\n&lt;ul&gt;\n&lt;/ul&gt;\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#custom-chat-with-tawkto","title":"Custom chat with Tawk.to","text":"<p>Go tohttps://www.tawk.to/</p> <p>Create an account and add the widget code to the custom HTML. If you want the chat box to be on every page add the code to the custom CSS.</p> <p>You can also change the colors in the Widget Appearance settings!</p> <p></p>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage/#bonus-html-for-system-overview","title":"Bonus HTML for system overview","text":"<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n&lt;meta name=\"apple-mobile-web-app-capable\" content=\"yes\"&gt;\n&lt;meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;\n&lt;ul&gt;\n&lt;/ul&gt;\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.io\"\ndata-dimensions=\"in\"'\ndata-chart-library=\"easypiechart\"\ndata-title=\"Disk Read\"'\ndata-width=\"200\"\ndata-height=\"200\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt; \n\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.io\"\ndata-dimensions=\"out\"'\ndata-chart-library=\"easypiechart\"\ndata-title=\"Disk Write\"'\ndata-width=\"200\"\ndata-height=\"200\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt; \n\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.cpu\"\ndata-chart-library=\"gauge\"\ndata-title=\"CPU\"\ndata-units=\"%\"\ndata-gauge-max-value=\"100\"\ndata-width=\"400\"\ndata-height=\"200\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-colors=\"#22AA99\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.net\"\ndata-dimensions=\"received\"\ndata-chart-library=\"easypiechart\"\ndata-title=\"IPv4 Inbound\"\ndata-width=\"200\"\ndata-height=\"200\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.net\"\ndata-dimensions=\"sent\"\ndata-chart-library=\"easypiechart\"\ndata-title=\"IPv4 Outbound\"\ndata-width=\"200\"\ndata-height=\"200\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div style=\"display: inline-block; position: relative;\"&gt;\n&lt;div data-netdata=\"system.ram\"\ndata-dimensions=\"used|buffers|active|wired\"\ndata-append-options=\"percentage\"\ndata-chart-library=\"easypiechart\"\ndata-title=\"Used RAM\"\ndata-units=\"%\"\ndata-easypiechart-max-value=\"100\"\ndata-colors=\"#EE9911\"\ndata-width=\"170\"\ndata-height=\"170\"\ndata-after=\"-300\"\ndata-points=\"300\"\ndata-dt-element-name=\"time701\"\n&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;/center&gt; \n&lt;/body&gt;\n\n&lt;script&gt;\n// this section has to appear before loading dashboard.js\n\n// Select a theme.\n// uncomment on of the two themes:\n\n// var netdataTheme = 'default'; // this is white\nvar netdataTheme = 'slate'; // this is dark\n\n// Set the default netdata server.\n// on charts without a 'data-host', this one will be used.\n// the default is the server that dashboard.js is downloaded from.\n\nvar netdataServer = 'https://YOURNETDATADOMAIN.COM/';\n&lt;/script&gt;\n\n&lt;!-- &lt;script type=\"text/javascript\" src=\"http://my.server:19999/dashboard.js\"&gt;&lt;/script&gt; --&gt;\n&lt;script type=\"text/javascript\" src=\"dashboard.js?v20170105-7\"&gt;&lt;/script&gt;\n\n&lt;script&gt;\n// Set options for TV operation\n// This has to be done, after dashboard.js is loaded\n\n// destroy charts not shown (lowers memory on the browser)\nNETDATA.options.current.destroy_on_hide = true;\n\n// set this to false, to always show all dimensions\n//NETDATA.options.current.eliminate_zero_dimensions = true;\n\n// lower the pressure on this browser\n//NETDATA.options.current.concurrent_refreshes = false;\n\n// if the tv browser is too slow (a pi?)\n// set this to false\n//NETDATA.options.current.parallel_refresher = true;\n\n// always update the charts, even if focus is lost\n\nNETDATA.options.current.stop_updates_when_focus_is_lost = false;\n\n// Since you may render charts from many servers and any of them may\n// become offline for some time, the charts will break.\n// This will reload the page every RELOAD_EVERY minutes\n\nvar RELOAD_EVERY = 1;\nsetTimeout(function(){\nlocation.reload();\n}, RELOAD_EVERY * 60 * 1000);\n\n&lt;/script&gt;\n\n&lt;/html&gt;\n</code></pre>","tags":["chat","customization","discord","homepage","letsencrypt","netdata","nginx","organizr","tawk"]},{"location":"blog/spice-up-your-homepage-part-ii/","title":"Spice up your homepage Part II","text":"","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#spice-up-your-homepage-part-ii","title":"Spice up your homepage Part II","text":"<p>Written: 2019-01-13</p> <p>Tags</p> <p> css </p> <p> grafana </p> <p> html </p> <p> influxdb </p> <p> monitorr </p> <p> nginx </p> <p> organizr </p> <p> subfilter </p> <p> varken </p> <p>Category</p> <p> frontend </p> <p></p> <p>I thought I'd make a follow up to the first post on customizing your Organizr homepage. This will tell you how to add Grafana panels, a custom Monitorr dashboard, custom buttons and links to tabs inside Organizr.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#using-grafana-and-varken-to-add-more-plex-stats-on-your-organizr-homepage","title":"Using Grafana and Varken to add more Plex stats on your Organizr homepage","text":"<p>With Grafana, InfluxDB and Varken we can add some cool plex stats to the dashboard using html and css. And if you install telegraf you can get some great host metrics also.</p> <p>Here is a screenshot of the stats I currently have on my Homepage.</p> <p></p> <p>All the panels are data from InfluxDB sent by Varken. I'm running nightly so I can have Varken pull download and upload data from my Ubiquiti Unifi Security Gateway. However, if you don't use Unifi you can setup telegraf and that will give you the same stats from the host machine.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#installing-influxdb","title":"Installing InfluxDB","text":"<p>Installing influxdb from CA is dead simple. You only need to select the host path for /var/lib/influxdb and change the host port if its in use. Varken will automatically create the database for you.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#installing-varken","title":"Installing Varken","text":"<p>I'm using the docker container from the devs, and since it's not currently on the CA Appstore you will have to add it manually. EDIT 16.03.19: They have added it to the CA appstore!</p> <p>Search for Varken and click on <code>Click Here To Get More Results From DockerHub</code> If you can't see that link you need to enable additional dockerHub search results in CA Settings.</p> <p></p> <p></p> <p></p> <p>Select <code>boerderij/varken</code> and add the PGID and PUID and mount the appdata folder to /config. Varken doesn't need a port as \"all\" it does is feed influxdb with data it pulls from Tautulli, Ombi, Sonarr, Radarr ect.</p> <p>Set PGID to 100 and PUID to 99</p> <p></p> <p></p> <p></p> <p>Setting up Varken is quite simple. Head over to your appdata folder and copy paste the <code>varken.example.ini</code> file and rename it <code>varken.ini</code></p> <p>In that file you add the connection details to all the services you want it to pull data from. Read through the configuration wiki for setup details.</p> <p>Tip: don't use the scheme(http://) when adding the different IPs. And if any of your services uses base url you need to add that.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#installing-grafana","title":"Installing Grafana","text":"<p>Follow the instructions and add your unraid/host ip and admin password.</p> <p>**GF_SERVER_ROOT_URL:**The url to which you will be navigating to get to the grafana dashboard. Typically your ip or hostname **GF_SECURITY_ADMIN_PASSWORD**Your password to use with the admin user. The default is user admin with password the password you chose.</p> <p>When Installing from CA you will need to add one variable to be able to view dashboards without logging in. Now you don't have to add it, but you will need to log into Grafana before you'll be able to see the stats of each panel on your Organizr homepage.</p> <p>First install the container without the variable as we need to mount the<code>custom.ini</code> file in our appdata, and the file needs to exist before we can mount it.</p> <p>After you've installed the container you need to add two plugins for the Varken dashboards. The dashboards will fail to load without them. Now, I'm only using the worldmap plugin on my homepage but you might as well install them both.</p> <p>Open terminal and run:</p> <p><code>**docker exec -i -t Grafana grafana-cli plugins install grafana-piechart-panel**</code> and <code>**docker exec -i -t Grafana grafana-cli plugins install grafana-worldmap-panel**</code></p> <p>Next go to you appdata location for Grafana and create the custom.ini file with the contents below:</p> <pre><code>[auth.anonymous]\nenabled=true\n</code></pre> <p>The variable you need to add is GF_PATHS_CONFIG and the value is <code>/var/lib/grafana/custom.ini</code></p> <p>Like so: <code>-e \"GF_PATHS_CONFIG=/var/lib/grafana/custom.ini\"</code></p> <p></p> <p>Note: Any new dashboard you create will be visible to anyone when you add this, so beware. Protect your reverse proxy with Organizr server auth. You can also choose which dashboards are open in dashboard settings. (Remove viewer role in permissions)</p> <p>Tip: You can create different organizations in Grafana and set the organization that you want open without auth. Like this:</p> <pre><code>[auth.anonymous]\nenabled=true\norg_name=&lt;organization_name&gt;\n</code></pre> <p>Update: Grafana recently added iframe protection so you will need to disable that. It can be done in two ways. Editing the custom.ini or adding a header in your webserver. Add:</p> <pre><code>[security]\nallow_embedding = true\n</code></pre> <p>in custom.ini Or <code>proxy_hide_header X-Frame-Options;</code> in your reverse proxy.</p> <p>After you've added the variable log in to Grafana and add your datasource. Go to \"Configuration\" and click + Add data source. Choose type <code>InfluxDB</code> Call it Varken Add your URL to InfluxDB And add the database <code>varken</code> (lower case) Click Save &amp; Test</p> <p></p> <p>After you have finished setting it up you can head over here to find the Varken dashboards that you can import.  </p> <p>Check the links below and paste in the dashboard ID and follow the steps on the screen.</p> <p></p> <p>https://grafana.com/dashboards?search=Varken</p> <p>You can find the stream breakdown and daily play count panels here:https://grafana.com/dashboards/9684</p> <p></p> <p>Add the dashboards you want. If you're using my dashboards select the correct datasource in the drop down like below.</p> <p>https://grafana.com/grafana/dashboards/9558</p> <p> After you've done that your should be able to see stats from the varken database.</p> <p>The way I have my dashboards setup is the main Varken dash is closed for \"visitors\" and I have a separate one for my Organizr homepage that is open. But it's not really open as it's behind Organizr server auth.</p> <p>So grafana.domain.com is only accessible to my Organizr users and me. Grafana will need to be reverse proxied as you can't access the local instance of Grafana when accessing Organizr through your domain.</p> <p>For a reverse proxy example of Grafana look here:https://github.com/gilbN/Nostromo/blob/master/Server/nginx/site-confs/grafana</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#organizr-homepage","title":"Organizr Homepage","text":"<p>Below is the custom HTML that you can use add the different panels you want to the Organizr homepage. Replace the source of each HTML class on this line.</p> <pre><code>src='https://grafana.domain.com/d-solo/bj0JnBMmz/org-dash?refresh=5s&amp;orgId=1&amp;panelId=22'/&gt;\n</code></pre> <p>The first six are the small \"widgets\" and the last three are the bigger ones.</p> <p>If you don't want the big widgets you can just delete everything between <code>&lt;!-- -------------------BIG WIDGET START------------------- --&gt;</code> and <code>**&lt;!-- -------------------BIG WIDGET END------------------- --&gt;**</code></p> <p>And if you want fewer small widgets just delete everything between: <code>&lt;!-- -------------------WIDGET------------------- --&gt;</code></p> <p></p> <p>To find the correct URL of each panel you just have to click on the name of the panel and select share, then select the Embed tab. **Remember to remove the \"Current time range\" as that will break the stats. **Don't copy it all, we just need the iframe source.</p> <p>If you want to change the title of the custom html you can do so here:</p> <pre><code>&lt;!-- -------------------ADD TITLE HERE------------------- --&gt;\n&lt;div id=\"announcementRow\" class=\"row\"&gt;&lt;h4 class=\"pull-left\"&gt;\n    &lt;span&gt;YOUR-TITLE-HERE&lt;/span&gt;&lt;/h4&gt;&lt;hr class=\"hidden-xs\"&gt;&lt;/div&gt;\n</code></pre> <p>Each panel can link directly to a tab inside Organizr. For that to work you need to edit this line:</p> <pre><code>&lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n</code></pre> <p>Replace**<code>TAB-NAME-HERE</code>with the actual tab name in Organizr. For the hover title, replace<code>TITLE-HERE</code>**or just remove it if you don't want the title attribute. If you don't want it to link to a tab simply remove the whole div.</p> <pre><code> `&lt;style&gt;\n.flex {\ndisplay: flex;\nflex-wrap: wrap;\nflex-direction: row;\nalign-items: center;\nbackground: transparent;\nbox-shadow: none !important;\ntransition: all .4s ease-in-out;\ncursor: pointer\n}\n\n/* -------------------Small widget------------------- */\n.flex-child { padding: 3px; flex-grow: 1; flex-basis: 0;}\n#grafanadwidget { position: relative; height: calc(80px); width: calc(100%);}\n/* -------------------Small widget------------------- */\n\n/* -------------------Big widget------------------- */\n.flex-child-big { padding: 3px; flex-grow: 1; flex-basis: 0;}\n#grafanadwidget-big { position: relative; height: calc(250px); width: calc(100%);}\n/* -------------------Big widget------------------- */\n\n/* -------------------iFrame Link------------------- */\n.iframe-link { z-index:1; position:absolute; height: calc(80px); width: calc(100%); background-color: transparent; cursor: pointer}\n/* -------------------iFrame Link------------------- */\n\n#announcementRow { background-color:transparent !important;}\n#announcementRow&gt;h4 {\npadding-left: 15px;\nfont-family: Rubik,sans-serif;\nmargin: 10px 0;\nfont-weight: 300 !important;\nline-height: 22px;\nfont-size: 18px;\ncolor: #dce2ec;\n}\n.overflowhider { height: 100%; overflow: hidden;}\n@media only screen and (max-width: 650px) {.flex-child-big {flex-basis: auto;min-width: auto !important;}}\n@media only screen and (max-width: 1125px) {.flex-child-big {flex-basis: auto;min-width: 600px;flex-basis: fit-content;}}\n@media only screen and (max-width: 1649px) {.flex-child {flex-basis: auto;}}\n&lt;/style&gt;\n\n&lt;!-- -------------------ADD TITLE HERE------------------- --&gt;\n&lt;div id=\"announcementRow\" class=\"row\"&gt;&lt;h4 class=\"pull-left\"&gt;\n    &lt;span&gt;Grafana&lt;/span&gt;&lt;/h4&gt;&lt;hr class=\"hidden-xs\"&gt;&lt;/div&gt;\n\n&lt;!-- -------------------SMALL WIDGET START------------------- --&gt;\n    &lt;div class=\"content-box flex\"&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt;\n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt; \n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt;     \n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt; \n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt;     \n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------WIDGET------------------- --&gt;     \n    &lt;div class=\"flex-child\" id=\"flex-grafanadwidget\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"flex\" id=\"grafanadwidget\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!-- -------------------SMALL WIDGET END------------------- --&gt;\n\n&lt;!-- -------------------BIG WIDGET START------------------- --&gt;   \n&lt;div class=\"content-box flex\"&gt;\n    &lt;!-- -------------------BIG WIDGET------------------- --&gt;        \n    &lt;div class=\"flex-child-big\" id=\"flex-grafanadwidget-big\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"flex\" id=\"grafanadwidget-big\" frameborder=\"0\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------BIG WIDGET------------------- --&gt;     \n    &lt;div class=\"flex-child-big\" id=\"flex-grafanadwidget-big\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget-big\" frameborder=\"0\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;\n    &lt;!-- -------------------BIG WIDGET------------------- --&gt;     \n    &lt;div class=\"flex-child-big\" id=\"flex-grafanadwidget-big\"&gt;\n    &lt;div class=\"overflowhider\"&gt;\n    &lt;div class=\"iframe-link\" onclick=\"tabActions(event,'TAB-NAME-HERE',1);\" href=\"#\" title=\"TITLE-HERE\"&gt;&lt;/div&gt;\n    &lt;iframe class=\"iframe\" id=\"grafanadwidget-big\" frameborder=\"0\" \n    frameborder=\"0\" src=\"ADD-URL-TO-GRAFANA-PANEL-HERE\"&gt;&lt;/iframe&gt;\n    &lt;/div&gt;&lt;/div&gt;   \n&lt;/div&gt;\n&lt;!-- -------------------BIG WIDGET END------------------- --&gt;` \n</code></pre>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#custom-css","title":"Custom CSS","text":"<p>For the widgets to match the Organizr theme you need to use custom CSS. You can do that by checking out my themes here.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#httpsgithubcomgilbnthemeparkblobmasterreadmemdgrafana-themes","title":"https://github.com/gilbN/theme.park/blob/master/README.md#grafana-themes","text":"<p>As Grafana doesn't support custom CSS you will need to use subfilter with nginx.</p> <p>Add this in you reverse proxy of Grafana:</p> <pre><code>proxy_set_header Accept-Encoding \"\";\nsub_filter\n'&lt;/head&gt;'\n'&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"https://gilbn.github.io/theme.park/CSS/themes/grafana/dark.css\"&gt;\n&lt;/head&gt;';\nsub_filter_once on;\n</code></pre> <p>For the plex/aquamarine/hotline themes you can use the <code>graforg-dashboard.css</code> instead.</p> <p>For panel integration on the Organizr homepage you can use<code>organizr-dashboard.css</code> if you use any of the custom themes. The theme is an \"internal\" theme that is meant to be used in an Organizr iframe as the background is set to transparent.</p> <p>NOTE: When viewing Grafana in Organizr iframe using<code>organizr-dashboard.css</code>it will follow the Organizr theme. When viewing it outside of Organizr iframe the background will be white ect. If you don't want this you can create two reverse proxies. One for grafana organizr homepage integration and one for the regular grafana theme.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#custom-buttons","title":"Custom buttons","text":"<p>Custom buttons is very easy to add. Just choose your flavor from the organizrTools repo and you're pretty much done! You can have buttons that link directly to tabs or buttons that uses Organizr built in functions like speed test or the request content function.</p> <p></p> <p>You can even link to tabs through html links.</p> <pre><code>&lt;a onclick=\"tabActions(event,'TAB NAME',1);\" href=\"#\"&gt;CUSTOM LINK TEXT&lt;/a&gt;\n</code></pre> <p>https://github.com/organizrTools/orgv2_custom_buttons</p> <p>I chose to edit the css a bit:</p> <p></p> <pre><code>.cbutton {\nborder-radius: 3px;\nborder: 4px solid;\nborder-color: #e5a00d;\npadding: 0px;\nwidth: auto;\nheight: auto;\nbackground-color: #e5a00d;\nposition: relative;\ntext-align: center;\n}\n</code></pre>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#monitorr","title":"Monitorr","text":"<p>Monitorr is a live display over the status of any webapp or service. And with some custom CSS we can have it match the Organizr-theme much better than the original.</p> <p>By using my <code>dark.css</code> theme from my theme.park repo you get a theme that blends with Organizr and it will compress the tiles a little so you can have more services on display.</p> <p>If you use a custom theme with organizr I reccoment the <code>organizr-dashboard.css</code> This theme will mess with your Monitorr base theme. And it will hide the settings button. Go to /monitorr/settings.php for settings. It is created purely for use with \"minimum\" version of the index.php <code>https://domain.com/monitorr/index.min.php</code>for Organizr homepage integration.</p> <p>NOTE: When viewing monitorr in an Organizr iframe using <code>organizr-dashboard.css</code> it will follow the Organizr theme as the background is transparent. When viewing it outside of Organizr iframe the background will be white ect. If you don't want this you can create two reverse proxies. One for monitorr organizr homepage integration and one for the other monitorr themes. And use subfilter on both instead of adding <code>@import \"https://gilbn.github.io/theme.park/CSS/themes/organizr-dashboard.css\";</code> in the monitorr custom css.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#adding-the-theme-with-nginx","title":"Adding the theme with Nginx","text":"<p>Add this to your Montorr minimized reverse proxy:</p> <pre><code>proxy_set_header Accept-Encoding \"\";\nsub_filter\n'&lt;/head&gt;'\n'&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"https://gilbn.github.io/theme.park/CSS/themes/monitorr/organizr-dashboard.css\"&gt;\n&lt;/head&gt;';\nsub_filter_once on;\n</code></pre> <p>And the <code>dark/aquamarine/hotline.css</code> on your main Monitorr reverse proxy.</p> <p>Adding it to Organizr is as simple as pasting this in custom HTML and changing the domain.</p> <pre><code>&lt;div id=\"announcementRow\" class=\"row\"&gt;&lt;h4 class=\"pull-left\"&gt;&lt;span&gt;Monitorr&lt;/span&gt;&lt;/h4&gt;&lt;hr class=\"hidden-xs\"&gt;&lt;/div&gt;\n&lt;div style=\"overflow:hidden; height:260px; -webkit-overflow-scrolling: touch; overflow-y: scroll;\"&gt;\n&lt;iframe class=\"iframe\" frameborder=\"0\" src=\"https://monitorr.domain.com/index.min.php\"&gt;&lt;/iframe&gt;\n&lt;/div&gt;\n</code></pre> <p>It's the <code>/index.min.php</code> that will display the minimized version.</p> <p>If you want to hide the scroll bar you can change the div style to <code>&lt;div style=\"overflow:hidden; height:260px\"&gt;</code> (FYI This will disable scrolling)</p> <p>Or you can do <code>&lt;div style=\"overflow:hidden; height:260px; width: calc(100% + 42px); -webkit-overflow-scrolling: touch; overflow-y: scroll;\"&gt;</code> if you use Firefox or <code>&lt;div style=\"overflow:hidden; height:260px; width: calc(100% + 36px); -webkit-overflow-scrolling: touch; overflow-y: scroll;\"&gt;</code> if you use Chrome.</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#custom-title","title":"Custom title","text":"<p>If you want to add a custom title to your different customizations you can simply add this line above it and replace the**<code>YOUR-CUSTOM-TITLE</code>**text with what you want.</p> <pre><code>&lt;div id=\"announcementRow\" class=\"row\"&gt;&lt;h4 class=\"pull-left\"&gt;&lt;span&gt;YOUR-CUSTOM-TITLE&lt;/span&gt;&lt;/h4&gt;&lt;hr class=\"hidden-xs\"&gt;&lt;/div&gt;\n</code></pre> <p>If you have any other awesome homepage customization please let me know in the comments!</p> <p>Edit: Thank you CauseFX for the iFrame fix!\u2764\ufe0f</p>","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/spice-up-your-homepage-part-ii/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["css","grafana","html","influxdb","monitorr","nginx","organizr","subfilter","varken"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/","title":"Visualizing Nginx geo data metrics  with Python, InfluxDB and Grafana","text":"","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana","title":"Visualizing Nginx geo data metrics  with Python, InfluxDB and Grafana","text":"<p>Written: 2020-05-13</p> <p>Tags</p> <p> geoip2 </p> <p> geolite2 </p> <p> grafana </p> <p> influx </p> <p> influxdb </p> <p> nginx </p> <p> python </p> <p>Category</p> <p> backend </p> <p></p> <p>A couple of weeks ago I saw someone posted an article on on the LinuxServer discord describing how to send geo data statistics from Nginx to InfluxDB. I have seen similar articles in the past and I always wanted to try it out, and because adding new dashboards to Grafana is always fun :)</p> <p>Note</p> <p>For people not using the letsencrypt/swag container, I've added a standalone container you can use here: https://github.com/gilbN/    geoip2influx</p> <p>The article was a couple of years old so he was using the now deprecated maxmind geoip database. But the rest of the Nginx configs looked just fine. As for the sending of the geo data metrics to InfluxDB, he was using a python2 script.</p> <p>Having recently started using Roxedus's Fail2Ban docker mod for the linuxserver swag container, I thought that would be an excellent way of running it. So I looked at how Roxedus set up his mod and used that as a template for building mine.</p> <p>Getting the script to work was simple enough, I just needed to adapt it for python3 and change a couple of small things, like adding environment variables for use with docker.</p> <p>I also tried to get Telegraf to parse the Nginx logs like he did in his guide, but it only parsed the logs once and didn't continue to send new log lines to InfluxDB. So I decided to make python parse it instead.</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#adding-the-docker-mod-to-the-swag-container","title":"Adding the docker mod to the swag container","text":"<p>Influx version</p> <p>Only InfluxDB v1.8.x supported!</p> <p>The mod is added using docker environment variables.</p> <p>The first one you need is <code>-e DOCKER_MODS=linuxserver/mods:swag-geoip2influx</code></p> <p>Here is a link to the repo if you want to have a look: https://github.com/gilbN/lsio-docker-mods/blob/master/letsencrypt/geoip2-nginx-stats Update 06.09.2020: I made a PR on the official linuxserver/docker-mods repo, and it' now been added there. https://github.com/linuxserver/docker-mods/tree/swag-geoip2influx</p> <p>The python script has some default variables added already, so you only need to add the ones that's different for your system.</p> <p>The available and default variables are:</p> <p><code>-e NGINX_LOG_PATH=/config/log/nginx/access.log</code></p> <p><code>-e INFLUX_HOST=localhost</code></p> <p><code>-e INFLUX_HOST_PORT=8086</code></p> <p><code>-e INFLUX_DATABASE=geoip2influx</code></p> <p><code>-e INFLUX_USER=root</code></p> <p><code>-e INFLUX_PASS=root</code></p> <p><code>-e INFLUX_RETENTION=7d</code></p> <p><code>-e INFLUX_SHARD=2d</code></p> <p><code>-e GEO_MEASUREMENT=geoip2influx</code></p> <p><code>-e LOG_MEASUREMENT=nginx_access_logs</code></p> <p><code>-e SEND_NGINX_LOGS=true</code></p> <p><code>-e GEOIP2INFLUX_LOG_LEVEL=INFO</code></p> <p><code>-e GEOIP2INFLUX_LOG_PATH=/config/log/geoip2influx/geoip2influx.log</code></p> <p>Most of them should be self explanatory, so I'll just add some comments on a couple of them.</p> <p><code>-e INFLUX_HOST=localhost</code> Since you will be setting this up inside the swag container, the default value will not work unless you are running the container with host networking and InfluxDB is installed on the same host. So change this to your host IP/docker dns name.</p> <p><code>GEO_MEASUREMENT=geoip2influx</code> and <code>-e LOG_MEASUREMENT=nginx_access_logs</code></p> <p>These are just the measurement names that will be sent to InfluxDB.</p> <p><code>-e INFLUX_DATABASE=geoip2influx</code></p> <p>The database will be created automatically by the python script, so no need to create one beforehand.</p> <p><code>-e INFLUX_RETENTION</code> and <code>-e INFLUX_SHARD</code></p> <p>Update 06.06.20: To try and mitigate <code>max-values-per-tag limit exceeded</code> errors I've added retention to the database. It will only add the retention policy if the database doesn't exist. Read more about retention policies here: https://www.influxdata.com/blog/influxdb-shards-retention-policies/ and https://docs.influxdata.com/influxdb/v1.2/concepts/key_concepts/#retention-policy</p> <p><code>-e MAXMINDDB_LICENSE_KEY=&lt;license-key&gt;</code></p> <p>Update 15.05.20: The swag container now natively supports downloading the geoip2 database with the use of the <code>MAXMINDDB_LICENSE_KEY</code> variable.</p> <p>Add your MaxMind Geoip2 license key and it will automatically download the latest database and update it weekly . The default download location is <code>/config/geoip2db/GeoLite2-City.mmdb</code>.</p> <p>If you're unsure how to obtain a licensekey, check out the first part of my geolite2 guide.</p> <p><code>-e GEOIP2INFLUX_LOG_LEVEL=INFO</code></p> <p>The script will automatically create a log file in the directory that <code>-e GEOIP2INFLUX_LOG_PATH</code> is set to. Set this to <code>DEBUG</code> for troubleshooting.</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#nginx-log-metrics","title":"Nginx log metrics","text":"<p>swag geolite2 instructions: https://technicalramblings.com/blog/blocking-countries-with-geolite2-using-the-letsencrypt-docker-container/</p> <p>For python to be able to parse the nginx logs correctly you need to update your nginx configs with a couple of lines.</p> <ul> <li>Add the following in the http block in your <code>nginx.conf</code> file:</li> </ul> <pre><code>geoip2 /config/geoip2db/GeoLite2-City.mmdb {\nauto_reload 5m;\n$geoip2_data_country_iso_code country iso_code;\n$geoip2_data_city_name city names en;\n}\n</code></pre> <pre><code>log_format custom '$remote_addr - $remote_user [$time_local]'\n'\"$request\" $status $body_bytes_sent'\n'\"$http_referer\" $host \"$http_user_agent\"'\n'\"$request_time\" \"$upstream_connect_time\"'\n'\"$geoip2_data_city_name\" \"$geoip2_data_country_iso_code\"';\n</code></pre> <ul> <li>Set the access log use the custom log format.</li> </ul> <pre><code>access_log /config/log/nginx/access.log custom;\n</code></pre> <p>The first time the scripts starts it will try and parse the log for 1 minute and if the regex doesn't match it will disable the log metrics. So be sure to refresh your site a couple of times after adding the mod.</p> <p>Next add a new datasource to Grafana with the name of the database you chose and import the dashboard and you should start seeing the map getting populated!</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#multiple-log-files","title":"Multiple log files","text":"<p>If you separate your nginx log files but want this mod to parse all of them you can do the following:</p> <p>As nginx can have multiple<code>access log</code>directives in a block, just add another one in the server block.</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#example","title":"Example","text":"<pre><code>access_log /config/log/nginx/technicalramblings/access.log custom;\naccess_log /config/log/nginx/access.log custom;\n</code></pre> <p>This will log the same lines to both files.</p> <p>Then use the<code>/config/log/nginx/access.log</code>file in the<code>NGINX_LOG_PATH</code>variable.</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#grafana-dashboard","title":"Grafana dashboard","text":"<p>Here is the link to the Grafana dashboard: https://grafana.com/grafana/dashboards/12268</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#other-statistics","title":"Other statistics","text":"<p>You can also add a Telegraf plugin for Nginx that gets some extra stats from the webserver.</p> <p>https://github.com/influxdata/telegraf/tree/master/plugins/inputs/nginx</p> <p>Location Block:</p> <pre><code>location /nginx_status {\nstub_status on;\naccess_log   off;\nallow 192.168.1.0/24; # Add the IP ranges you want to access. \ndeny all;\n}\n</code></pre> <p>Sources: https://medium.com/faun/total-nginx-monitoring-with-application-performance-and-a-bit-more-using-8fc6d731051b https://geoip2.readthedocs.io/en/latest/ https://www.influxdata.com/blog/getting-started-python-influxdb/ https://grafana.com/grafana/dashboards/8522 https://www.geeksforgeeks.org/python-reading-last-n-lines-of-a-file/</p>","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]},{"location":"blog/visualizing-nginx-geo-data-metrics-with-python-influxdb-and-grafana/#if-you-need-any-extra-help-join-the-discord-server","title":"If you need any extra help join the Discord server","text":"","tags":["geoip2","geolite2","grafana","influx","influxdb","nginx","python"]}]}